<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Smart Note Taker</title>
  <!-- Google Font: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
   
   /* ===============================
   Global Styles & CSS*/
body {
  margin: 0;
  padding: 0;
  font-family: 'Poppins', sans-serif;
  background-color: #121212;
  color: #e0e0e0;
}



/* ===============================
   Animations
   =============================== */
@keyframes fadeIn {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.fade-in {
  animation: fadeIn 1.5s ease forwards;
}

/* ===============================
   Header & Note Type Buttons
   =============================== */
.header {
  text-align: center;
  margin-bottom: 30px;
  padding: 20px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  border-radius: 10px;
  box-shadow: 7px 6px 12px rgba(0, 0, 0, 0.3);
  margin-top: 50px;
  width: 100%;
}
.header h1 {
  font-size: 2.5em;
  margin: 0;
  color: #000;
  text-shadow: 7px 6px 12px rgba(0, 0, 0, 0.3);
}
.header h8 {
  color: #000;
}

.note-types {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-bottom: 20px;
  flex-wrap: wrap;
  width: 100%;
}
.note-type-btn {
  padding: 10px 20px;
  cursor: pointer;
  border: none;
  border-radius: 5px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  font-weight: bold;
  transition: background 0.3s, transform 0.2s;
}
.note-type-btn:hover {
  transform: translateY(-2px);
  background: linear-gradient(135deg, #2196F3, #21CBF3);
}
.note-type-btn.active {
  box-shadow: 0 0 10px rgba(33, 150, 243, 0.8);
}

/* ===============================
   Note Sections (Unified Container)
   =============================== */
.note-section {
  display: none;
  background: #1e1e1e;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.5);
  margin-bottom: 20px;
  width: 100%;

}
.note-section.active {
  display: block;
}

/* ===============================
   Regular Notes – Notebook Feature
   =============================== */
/* Notebooks View */
.notebook-creator {
  margin-bottom: 20px;
  display: flex;
  gap: 10px;
}
#notebookTitleInput {
  flex: 1;
  padding: 10px;
  border: 1px solid #333;
  border-radius: 4px;
  background-color: #333;
  color: #e0e0e0;
  font-size: 1em;
}
.notebook-creator button {
  padding: 10px 15px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s, transform 0.2s;
  display: block;
  margin: 10px auto;
}
.notebook-creator button:hover {
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  transform: translateY(-2px);
}
.notebooks-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}
.notebook {
  background-color: #1e1e1e;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  cursor: pointer;
  position: relative;
  transition: transform 0.2s;
}
.notebook:hover {
  transform: scale(1.02);
}
.notebook h3 {
  margin: 0;
  font-size: 1.2em;
  color: #e0e0e0;
}
.notebook .delete-btn {
  background: none !important;
  color: #4fc3f7 !important;
  box-shadow: none !important;
  width: 28px;
  height: 28px;
  border: 1px solid #4fc3f7 !important;
  transition: all 0.3s ease;
}
.notebook .delete-btn:hover {
  background-color: #ff453a;
}

#notebookNotesView .delete-btn{
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 0;
  border: none;
  cursor: pointer;
  color:  #808080;
  font-size: 1em;
  width: 30px;
  height: 30px;
  border-radius: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  transition: background-color 0.3s, transform 0.2s;
}

/* Notebook Notes View */
#notebookNotesView {
  display: none;
  background: #1e1e1e;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.5);
  margin-top: 20px;
}
#notebookNotesView button.back-btn {
  margin-bottom: 10px;
  padding: 10px 15px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s, transform 0.2s;
  display: block;
  margin: 10px auto;
}
#notebookNotesView button.back-btn:hover {
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  transform: translateY(-2px);
}
#notebookTitleHeader {
  margin: 10px 0;
  font-size: 1.5em;
  color: #e0e0e0;
  text-align: center;
}

/* Edit Button for Notebook Notes */
.edit-btn {
  padding: 0;
  width: 30px;
  height: 30px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 1em;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  transition: background 0.3s, transform 0.2s;
  margin-right: 45px;
  margin-top: 10px;
}
.edit-btn:hover {
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  transform: translateY(-2px);
}
.note-buttons {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 5px;
}

/* ===============================
   Existing Checklist & Locked Notes Styles
   =============================== */
.note-creator {
  background-color: #1e1e1e;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  margin-bottom: 20px;
  text-align: center;
}
.note-creator textarea {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border: 1px solid #333;
  border-radius: 4px;
  resize: vertical;
  background-color: #333;
  color: #e0e0e0;
  font-size: 1em;
}
.note-creator button {
  padding: 10px 15px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s, transform 0.2s;
  display: block;
  margin: 10px auto;
}
.note-creator button:hover {
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  transform: translateY(-2px);
}
.notes-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
}
.note {
  background-color: #1e1e1e;
  padding: 10px 15px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  position: relative;
  transition: background-color 0.3s, transform 0.2s;
  height: auto;
}
.note:hover {
  transform: scale(1.02);
}
.note.locked {
  background-color: #2c2c2c;
}
.note-content {
  margin: 0;
  padding: 0;
  line-height: 1.2;
  white-space: pre-wrap;
}
.delete-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 0;
  border: none;
  cursor: pointer;
  color:  #808080;
  font-size: 1em;
  width: 30px;
  height: 30px;
  border-radius: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  transition: background-color 0.3s, transform 0.2s;
}
.delete-btn:hover {
  background-color: #2c57b5;
  transform: scale(1.1);
}
.locked-placeholder {
  padding: 20px;
  text-align: center;
  color: #aaa;
  font-style: italic;
  border: 1px dashed #555;
  border-radius: 4px;
}

/* ============================
   Enhanced Checklist Section CSS
   ============================ */


/* ============================
   Modern Enhanced Checklist Section CSS
   ============================ */

/* Define Custom Properties for Consistency */
:root {
  --primary-color: #4a90e2;      /* Blue */
  --secondary-color: #50e3c2;    /* Teal */
  --accent-color: #4a90e2;       /* Changed from green to blue */
  --background-color: #1f1f1f;   /* Dark background */
  --card-bg: rgba(255,255,255,0.05);
  --text-color: #e0e0e0;
}

/* (Optional) Wrap your entire checklist section in a container */
.checklist-section-container {
  padding: 20px;
  background: #1e1e1e;
  border-radius: 16px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.5);
}

/* --- Checklist Groups View --- */
#checklistGroupsView {
  padding: 25px;
  background:  #1e1e1e;
  border-radius: 16px;
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  margin-bottom: 30px;
}

.checklist-group-creator {
  display: flex;
  gap: 15px;
  margin-bottom: 20px;
}

.checklist-group-creator input {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 12px;
  background-color: rgba(255,255,255,0.1);
  color: #e0e0e0;
  font-size: 1em;
}

.checklist-group-creator button {
  padding: 12px 20px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #fff;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1em;
  transition: transform 0.2s, box-shadow 0.2s;
}

.checklist-group-creator button:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  background: linear-gradient(135deg, #2196F3, #21CBF3);
}

#checklistGroupsList {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
}

.checklist-group {
  background: rgba(255,255,255,0.05);
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  transition: transform 0.2s, box-shadow 0.2s;
  position: relative;
  cursor: pointer;
}

.checklist-group:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px rgba(0,0,0,0.35);
}

.checklist-group h3 {
  margin: 0;
  font-size: 1.3em;
  color: #e0e0e0;
  text-align: center;
  cursor: pointer;
}

.checklist-group .delete-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 0;
  border: none;
  cursor: pointer;
  color:  #808080;
  font-size: 1em;
  width: 30px;
  height: 30px;
  border-radius: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  transition: background-color 0.3s, transform 0.2s;
}


.checklist-group .delete-btn:hover {
  transform: scale(1.1);
}

/* --- Checklist Group Notes View --- */
#checklistGroupNotesView {
  padding: 25px;
  background: rgba(255,255,255,0.05);
  border-radius: 16px;
  backdrop-filter: blur(8px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  margin-top: 30px;
}

#checklistGroupTitleHeader {
  text-align: center;
  font-size: 1.8em;
  margin-bottom: 20px;
  color: #e0e0e0;
  font-weight: 600;
}

#checklistGroupNotesView .note-creator {
  margin-bottom: 25px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 15px;
}

/* Change the text color for the 'Add Checklist' button to black */
#checklistGroupNotesView .note-creator button {
  padding: 12px 20px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #000;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-size: 1em;
  transition: transform 0.2s, box-shadow 0.2s;
}

#checklistGroupNotesView .note-creator button:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
  background: linear-gradient(135deg, #2196F3, #21CBF3);
}

#checklistGroupNotesView .note-creator textarea {
  width: 100%;
  max-width: 600px;
  padding: 18px;
  border: none;
  border-radius: 12px;
  background: rgba(255,255,255,0.1);
  color: #e0e0e0;
  font-size: 1em;
  resize: vertical;
}

/* Reduced gap between checklist notes */
#checklistGroupNotes {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 2px;
}

/* --- Enhanced Checklist Items --- */
.checklist-item {
  display: flex;
  align-items: center;
  background: rgba(255,255,255,0.05);
  padding: 5px;
  border-radius: 12px;
  margin-bottom: 0px;
  transition: background 0.3s;
}

.checklist-item:hover {
  background: rgba(255,255,255,0.1);
}

.checklist-item input[type="checkbox"] {
  -webkit-appearance: none;
  appearance: none;
  width: 24px;
  height: 24px;
  border: 2px solid #fff;
  border-radius: 6px;
  margin-right: 12px;
  cursor: pointer;
  position: relative;
  transition: background 0.3s, border-color 0.3s;
}

.checklist-item input[type="checkbox"]:checked {
  background: #2196F3;
  border-color: #2196F3;
}

.checklist-item input[type="checkbox"]:checked::after {
  content: "✔";
  position: absolute;
  top: -2px;
  left: 4px;
  color: #fff;
  font-size: 18px;
  font-weight: bold;
}

.checklist-item span {
  flex: 1;
  color: #e0e0e0;
  font-size: 1em;
  width: 100%;
}

/* ===========================
       Checklist Groups Section
       =========================== */
#checklistGroupsView {
  display: block;
}
.checklist-group-creator {
  margin-bottom: 20px;
  display: flex;
  gap: 10px;
  text-align: center;
}
#checklistGroupTitleInput {
  flex: 1;
  padding: 10px;
  border: 1px solid #333;
  border-radius: 4px;
  background-color: #333;
  color: #e0e0e0;
  font-size: 1em;
}
.checklist-group-creator button {
  padding: 10px 15px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s, transform 0.2s;
  display: block;
  margin: 10px auto;
}
.checklist-group-creator button:hover {
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  transform: translateY(-2px);
}
#checklistGroupsList {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 20px;
}
.checklist-group {
  background-color: #1e1e1e;
  padding: 15px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  cursor: pointer;
  position: relative;
  transition: transform 0.2s;
}
.checklist-group:hover {
  transform: scale(1.02);
}
.checklist-group h3 {
  margin: 0;
  font-size: 1.2em;
  color: #e0e0e0;
}
.checklist-group .delete-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 0;
  border: none;
  cursor: pointer;
  color:  #808080;
  font-size: 1em;
  width: 30px;
  height: 30px;
  border-radius: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 4px rgba(0,0,0,0.5);
  transition: background-color 0.3s, transform 0.2s;
}


.checklist-group .delete-btn:hover {
  background-color: #ff453a;
}
/* Checklist Group Notes View */
#checklistGroupNotesView {
  display: none;
}
#checklistGroupNotesView button.back-btn {
  margin-bottom: 10px;
  padding: 10px 15px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s, transform 0.2s;
  display: block;
  margin: 10px auto;
}
#checklistGroupNotesView button.back-btn:hover {
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  transform: translateY(-2px);
}
#checklistGroupTitleHeader {
  margin: 10px 0;
  font-size: 1.5em;
  color: #e0e0e0;
  text-align: center;
}

/* ===============================
   Locked Notes Section
   =============================== */
#lockedSection .note-creator {
  text-align: center;
  margin-bottom: 20px;
}
#lockedSection .note-creator textarea {
  width: 100%;
  padding: 10px;
  border: 1px solid #333;
  border-radius: 4px;
  resize: vertical;
  background-color: #333;
  color: #e0e0e0;
  font-size: 1em;
}
#lockedSection .notes-container {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
}
.note.locked {
  background-color: #2c2c2c;
}
.note-content {
  line-height: 1.2;
  white-space: pre-wrap;
}

/* Unlock Button */
.unlock-btn {
  display: block;
  margin: 10px auto 0;
  padding: 10px 15px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s, transform 0.2s;
}
.unlock-btn:hover {
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  transform: translateY(-2px);
}


/* ===============================
   Media Queries for Responsive Design
   =============================== */
@media (max-width: 600px) {
  .images-container {
    grid-template-columns: repeat(2, 1fr); /* Two columns for mobile */
  }
}

@media (min-width: 601px) {
  .images-container {
    grid-template-columns: repeat(2, 1fr); /* Two columns for larger screens as well */
  }
}

/* ===============================
   #bt Button (Additional)
   =============================== */
#bt {
  display: block;
  margin: 10px auto 0;
  padding: 10px 15px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s, transform 0.2s;
}

/* ===============================
   Backup Controls – Top Corners
   =============================== */
#exportBtn,
#importBtn {
  padding: 16px 16px;
  font-size: 0.9em;
  border: none;
  border-radius: 4px;
  background: linear-gradient(135deg, #312c2c, #327cc5);
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: background 0.3s, transform 0.2s;
  position: fixed;
  top: 10px;
  z-index: 1001;
}
#exportBtn:hover,
#importBtn:hover {
  background: linear-gradient(135deg, #B71C1C, #1565C0);
  transform: translateY(-2px);
}
#exportBtn { left: 10px; }
#importBtn { right: 10px; }

/* ===============================
   Password Prompt Modal
   =============================== */
.password-prompt {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #1e1e1e;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.7);
  z-index: 1000;
  width: 90%;
  max-width: 400px;
}
.password-prompt input {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border: 1px solid #333;
  border-radius: 4px;
  background-color: #333;
  color: #e0e0e0;
  font-size: 1em;
}
.password-prompt button {
  width: 100%;
  padding: 10px;
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  color: #121212;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1em;
  transition: background 0.3s, transform 0.2s;
}
.password-prompt button:hover {
  background: linear-gradient(135deg, #2196F3, #21CBF3);
  transform: translateY(-2px);
}

/* Add a loading indicator style */
.loading-indicator {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.7);
  color: white;
  padding: 20px;
  border-radius: 10px;
  z-index: 1000;
}


:root {
            --primary: #e2e8f0;
            --secondary: #3b82f6;
            --accent: #ef4444;
            --light: #1e293b;
            --success: #22c55e;
            --dark: #0f172a;
            --card-bg: #1e293b;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --hover-bg: rgba(255,255,255,0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, var(--dark), #1e1b4b);
            padding: 20px;
            color: var(--text-primary);
            
        }

        .container {
            width: 100%;
            max-width: 1200px;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
            margin-top: 120px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        h1 {
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 40px;
            font-size: 3em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }

        .auth-section {
            text-align: center;
            max-width: 400px;
            margin: 0 auto;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .google-logo {
            margin-bottom: 30px;
        }

        .google-logo img {
            width: 180px;
            height: auto;
        }

        .google-btn {
            background: white;
            color: #3c4043;
            border: 1px solid #dadce0;
            padding: 12px 25px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin: 20px auto;
            width: 100%;
            letter-spacing: 0.25px;
        }

        .google-btn img {
            width: 18px;
            height: 18px;
        }

        .google-btn:hover {
            background: #f8f9fa;
            box-shadow: 0 1px 3px rgba(60,64,67,0.3);
            border-color: #dadce0;
        }

        .google-btn:active {
            background: #f1f3f4;
            box-shadow: 0 1px 3px rgba(60,64,67,0.5);
        }

        .or-divider {
            display: flex;
            align-items: center;
            text-align: center;
            margin: 20px 0;
            color: #666;
        }

        .or-divider::before,
        .or-divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid #ddd;
        }

        .or-divider span {
            padding: 0 10px;
        }

        input[type="password"] {
            width: 100%;
            padding: 15px 20px;
            margin: 15px 0;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s;
            background: var(--dark);
            color: var(--text-primary);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        input[type="password"]:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
            outline: none;
            transform: translateY(-2px);
        }

        input[type="password"]::placeholder {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        button {
            background: var(--secondary);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .choose-files-btn {
            width: 100%;
            background: var(--secondary);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-size: 18px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
        }

        .choose-files-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }

        .choose-files-btn i {
            font-size: 24px;
        }

        .controls {
            background: var(--dark);
            padding: 20px;
            border-radius: 15px;
            margin: 30px 0;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .sort-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .sort-btn {
            background: var(--dark) !important;
            border: 1px solid rgba(255,255,255,0.1) !important;
            color: var(--text-secondary) !important;
            padding: 8px 16px !important;
            border-radius: 8px !important;
            transition: all 0.3s !important;
        }

        .sort-btn:hover {
            border-color: var(--secondary) !important;
            color: var(--text-primary) !important;
        }

        .sort-btn.active {
            background: var(--secondary) !important;
            color: white !important;
            border-color: var(--secondary) !important;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .image-card {
            background: var(--dark);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            transition: all 0.3s;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .image-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.4);
            border-color: var(--secondary);
        }

        .image-card img {
            width: 100%;
            height: 200px;
            object-fit:contain;
        }

        
        .image-info span {
            font-size: 13px;
            color: var(--text-primary);
            line-height: 1.3;
            word-break: break-word;
            white-space: normal;
            width: 40%;

        }

        .image-info .buttons {
            display: flex;
            gap: 0px;
            align-items: center;
          
            
        }

        .image-info button {
            padding: 5px;
            background: transparent;
            font-size: 14px;
            border: none;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s;
            width: auto;
            height: 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            
        }

        .image-info button:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
            transform: scale(1.1);
        }

        .image-info .name-edit-container {
            display: flex;
            align-items: flex-start;
            gap: 0px;
            flex: 0;
           
        }

        .edit-name-input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            font-size: 13px;
            display: none;
            margin-right: 1px;
            min-width: 0;
            line-height: 1.3;
            background: var(--dark);
            color: var(--text-primary);
        }

        .edit-name-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

        .edit-btn {
            color: #666 !important;
            display: flex !important;
        }

        .edit-btn i {
            font-size: 14px;
        }

        .save-btn, .cancel-btn {
            display: none !important;
            color: #666 !important;
            visibility: hidden;
        }

        .save-btn.show, .cancel-btn.show {
            display: flex !important;
            visibility: visible;
        }

        #delete-btn {
            color: #c80606 !important;
            display: flex !important;
        }

        #delete-btn:hover {
            color: var(--accent) !important;
        }

        .save-icon-btn {
            background: var(--success);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: none;
            padding: 0;
            font-size: 16px;
        }

        .save-icon-btn:hover {
            transform: scale(1.1);
        }

        .save-icon-btn.show {
            display: flex;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            display: none;
            z-index: 2000;
        }

        .loading.active {
            display: block;
        }

        .loading i {
            margin-right: 10px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 90%;
            max-height: 90vh;
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            background: var(--dark);
        }

        .modal-content img {
            max-width: 100%;
            max-height: 90vh;
            object-fit: contain;
            border-radius: 10px;
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 30px;
            cursor: pointer;
            background: rgba(0,0,0,0.5);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: rgba(0,0,0,0.8);
        }

        .hidden {
            display: none;
        }

        #logoutBtn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent);
            border-radius: 25px;
            padding: 10px 20px;
        }

        #logoutBtn i {
            margin-right: 5px;
        }

        .empty-gallery {
            text-align: center;
            padding: 50px;
            color: var(--text-secondary);
        }

        .empty-gallery i {
            font-size: 50px;
            color: var(--secondary);
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .gallery {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 20px;
            }
            
            h1 {
                font-size: 2em;
            }
        }

        .image-info .image-name {
            white-space: nowrap; /* Prevent text from wrapping */
            overflow: hidden; /* Hide overflow text */
            text-overflow: ellipsis; /* Show ellipsis for overflow text */
            max-width: 100px; /* Set a maximum width for the name */
            display: inline-block; /* Ensure it behaves like a block element */
            flex: 1;
        }

        .image-info {
            padding: 6px;
            display: flex;
            /* Space between items */
            align-items: center; /* Center items vertically */
            min-height: 30px;
        
  </style>
</head>
<body>
  <!-- Backup Controls -->
  <button id="exportBtn" onclick="exportData()">Backup</button>
  <input type="file" id="backupFileInput" style="display: none;" accept=".json" onchange="importData(this.files[0])" />
  <button id="importBtn" onclick="document.getElementById('backupFileInput').click()">Import Backup</button>
  
  
    <div class="header">
      <h1>eNotes</h1>
      <h8>-by Aditya</h8>
    </div>
    <div class="note-types">
      <button class="note-type-btn active" onclick="showSection('regular')">Regular</button>
      <button class="note-type-btn" onclick="showSection('checklist')">Checklists</button>
      <button class="note-type-btn" onclick="showSection('locked')">Locked</button>
      <button class="note-type-btn" onclick="showSection('images')">Images</button>
    </div>
    
    <!-- Regular Notes Section with Notebook Feature -->
    <div class="note-section active" id="regularSection">
      <!-- Notebooks View -->
      <div id="notebooksView">
        <div class="notebook-creator">
          <input type="text" id="notebookTitleInput" placeholder="Enter Notebook Title..." />
          <button onclick="createNotebook()">Create Notebook</button>
        </div>
        <div class="notebooks-container" id="notebooksList"></div>
      </div>
      <!-- Notebook Notes View -->
      <div id="notebookNotesView" style="display: none;">
        <button class="back-btn" onclick="backToNotebooks()">Back to Notebooks</button>
        <h2 id="notebookTitleHeader"></h2>
        <div class="note-creator">
          <textarea id="notebookNoteContent" placeholder="Write your note here..."></textarea>
          <button onclick="createNoteInNotebook()">Add Note</button>
        </div>
        <div class="notes-container" id="notebookNotes"></div>
      </div>
    </div>
    
    <!-- Checklist Section with Group Feature -->
    <div class="note-section" id="checklistSection">
      <!-- Checklist Groups View -->
      <div id="checklistGroupsView">
        <div class="checklist-group-creator">
          <input type="text" id="checklistGroupTitleInput" placeholder="Enter Checklist Group Title..." />
          <button onclick="createChecklistGroup()">Create Checklist Group</button>
        </div>
        <div id="checklistGroupsList" class="notebooks-container"></div>
      </div>
      <!-- Checklist Group Notes View -->
      <div id="checklistGroupNotesView" style="display: none;">
        <button class="back-btn" onclick="backToChecklistGroups()">Back to Checklist Groups</button>
        <h2 id="checklistGroupTitleHeader"></h2>
        <div class="note-creator">
          <textarea id="checklistNoteContent" placeholder="Add checklist items (one per line)"></textarea>
          <button onclick="createChecklistNoteInGroup()">Add Checklist</button>
        </div>
        <div id="checklistGroupNotes" class="notes-container"></div>
      </div>
    </div>
    
    <!-- Locked Notes Section -->
    <div class="note-section" id="lockedSection">
      <div class="note-creator">
        <textarea id="lockedContent" placeholder="Write your locked note here..."></textarea>
        <button onclick="createNote('locked')">Lock Note</button>
        <button class="unlock-btn" onclick="showPasswordPrompt()">Unlock Locked Section</button>
      </div>
      <div class="notes-container" id="lockedNotes"></div>
    </div>
    
    <!-- Images Section -->
    <div class="note-section" id="imagesSection"> <!-- Ensure this is a note-section -->
      
        <h1>Secured Images </h1>
        
        <!-- Authentication Section -->
        <div class="auth-section" id="authSection">
            <input type="password" id="passwordInput" placeholder="Enter your secret password">
            <button onclick="initializeVault()"><i class="fas fa-unlock"></i> Unlock Vault</button>
        </div>

        <!-- Main Content -->
        <div id="mainContent" class="hidden">
            <input type="file" id="imageInput" accept="image" multiple hidden onchange="uploadImages()">
            <button class="choose-files-btn" onclick="document.getElementById('imageInput').click()">
                <i class="fas fa-cloud-upload-alt"></i>
                Choose Images to Upload
            </button>

            

            <div class="gallery" id="gallery"></div>
            <button id="deleteAllBtn" style="position: fixed; top: 20px; right: 20px; margin-bottom: 10px; background: rgb(159, 4, 4); border-radius: 25px; padding: 10px 15px; color: white; border: none; cursor: pointer; z-index: 1000; font-size: 12px;">
                🗑️ Delete All
            </button>
        </div>

        <div class="loading" id="loading">
            <i class="fas fa-spinner"></i> Processing...
        </div>

        <!-- Add Modal HTML -->
        <div class="modal" id="imageModal">
            <div class="modal-content">
                <span class="close-modal" onclick="closeModal()">×</span>
                <img id="modalImage" src="" alt="Full size image">
            </div>
        </div>
      
    </div> <!-- End of Images Section -->
  
  
  <!-- Password Prompt Modal -->
  <div class="password-prompt" id="passwordPrompt">
    <input type="password" id="passwordInput" placeholder="Enter password" />
    <button onclick="unlockSection()">Unlock</button>
  </div> 
  
  <!-- Include External JS -->


  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <script>
    /* ============ Global Variables ============ */
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
let currentSection = 'regular';
let lockedSectionPassword = localStorage.getItem('lockedSectionPassword') || null;
let lockedSectionUnlocked = false;
let currentNotebookId = null;
let editingNoteId = null;
let currentChecklistGroupId = null;

let lastTapTime = 0; // Variable to store the last tap time

/* ============ Section Switching ============ */
function showSection(section) {
  // Save current section to localStorage
  localStorage.setItem('lastOpenedSection', section);
  
  document.querySelectorAll('.note-section').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.note-type-btn').forEach(el => el.classList.remove('active'));
  document.getElementById(section + 'Section').classList.add('active');
  document.querySelector(`button[onclick="showSection('${section}')"]`).classList.add('active');
  currentSection = section;
}

/* ============ Regular, Checklist & Locked Notes ============ */
function createNote(type) {
  const contentField = document.getElementById(`${type}Content`);
  if (!contentField) return;
  const rawContent = contentField.value.trim();
  if (!rawContent) {
    alert('Please enter some content!');
    return;
  }
  const note = {
    id: Date.now(),
    type,
    timestamp: new Date().toLocaleDateString('en-GB')
  };
  if (type === 'checklist') {
    const lines = rawContent.split('\n').map(line => line.trim()).filter(line => line !== '');
    note.content = lines;
    note.checkedItems = Array(lines.length).fill(false);
  } else {
    note.content = rawContent;
    note.checkedItems = [];
  }
  if (type === 'locked') {
    if (!lockedSectionPassword) {
      lockedSectionPassword = prompt('Set a password for the locked section:');
      if (lockedSectionPassword) {
        localStorage.setItem('lockedSectionPassword', lockedSectionPassword);
      } else {
        alert("Password is required to create locked notes!");
        return;
      }
    }
  }
  saveNote(note);
  renderNotes();
  clearInputs(type);
}

function saveNote(note) {
  const notes = JSON.parse(localStorage.getItem('notes') || '[]');
  notes.push(note);
  localStorage.setItem('notes', JSON.stringify(notes));
}

function renderNotes() {
  const notes = JSON.parse(localStorage.getItem('notes') || '[]');
  // Update only checklist and locked notes (regular notes are in notebooks)
  ['checklist', 'locked'].forEach(type => {
    const container = document.getElementById(`${type}Notes`);
    if (container) {
      container.innerHTML = notes
        .filter(note => note.type === type)
        .map(note => createNoteElement(note))
        .join('');
    }
  });
}

function createNoteElement(note) {
  let content = '';
  if (note.type === 'checklist') {
    const items = Array.isArray(note.content) ? note.content : note.content.split('\n');
    const checkedItems = Array.isArray(note.checkedItems) ? note.checkedItems : Array(items.length).fill(false);
    content = items.map((item, index) => `
      <label class="checklist-item">
        <input type="checkbox" onchange="toggleCheckbox(${note.id}, ${index}, this.checked)" ${checkedItems[index] ? 'checked' : ''}>
        <span>${item}</span>
      </label>
    `).join('');
  } else if (note.type === 'locked') {
    if (lockedSectionUnlocked) {
      content = note.content;
    } else {
      content = '<div class="locked-placeholder">This note is locked. Unlock to view.</div>';
    }
  } else {
    content = note.content.replace(/\n/g, '<br>');
  }
  return `
    <div class="note ${note.type === 'locked' ? 'locked' : ''}" id="note-${note.id}">
      <button class="delete-btn" onclick="deleteNote(${note.id})"><i class="fas fa-trash"></i></button>
      <div class="note-content">${content}</div>
      <small>${note.timestamp}</small>
    </div>
  `;
}

function toggleCheckbox(noteId, itemIndex, newState) {
  const notes = JSON.parse(localStorage.getItem('notes') || '[]');
  const note = notes.find(n => n.id === noteId);
  if (note && note.type === 'checklist') {
    if (!Array.isArray(note.checkedItems)) {
      const items = Array.isArray(note.content) ? note.content : note.content.split('\n');
      note.checkedItems = Array(items.length).fill(false);
    }
    note.checkedItems[itemIndex] = newState;
    localStorage.setItem('notes', JSON.stringify(notes));
    renderNotes();
  }
}

function showPasswordPrompt() {
  document.getElementById('passwordPrompt').style.display = 'block';
}

function unlockSection() {
  const password = document.getElementById('passwordInput').value;
  if (password === lockedSectionPassword) {
    lockedSectionUnlocked = true;
    document.getElementById('passwordPrompt').style.display = 'none';
    renderNotes();
  } else {
    alert('Wrong password!');
  }
}

function deleteNote(id) {
  const notes = JSON.parse(localStorage.getItem('notes') || '[]');
  const note = notes.find(note => note.id === id);
  if (note && note.type === 'locked' && !lockedSectionUnlocked) {
    alert("Please unlock the locked notes section before deleting a locked note.");
    return;
  }
  if (confirm("Are you sure you want to delete this note?")) {
    const filteredNotes = notes.filter(note => note.id !== id);
    localStorage.setItem('notes', JSON.stringify(filteredNotes));
    renderNotes();
  }
}

function clearInputs(type) {
  const element = document.getElementById(`${type}Content`);
  if (element) element.value = '';
}

/* ============ Notebook Feature ============ */
function loadNotebooks() {
  const notebooks = JSON.parse(localStorage.getItem('notebooks') || '[]');
  renderNotebooks(notebooks);
}

function renderNotebooks(notebooks) {
  const notebooksList = document.getElementById('notebooksList');
  if (notebooks.length === 0) {
    notebooksList.innerHTML = '<p>No notebooks found. Please create one.</p>';
  } else {
    notebooksList.innerHTML = notebooks.map(nb => `
      <div class="notebook">
        <h3 onclick="openNotebook(${nb.id})">${nb.title}</h3>
        <button class="delete-btn" onclick="deleteNotebook(event, ${nb.id})"><i class="fas fa-trash"></i></button>
      </div>
    `).join('');
  }
}

function createNotebook() {
  const titleInput = document.getElementById('notebookTitleInput');
  const title = titleInput.value.trim();
  if (!title) {
    alert('Please enter a notebook title.');
    return;
  }
  const notebooks = JSON.parse(localStorage.getItem('notebooks') || '[]');
  const newNotebook = {
    id: Date.now(),
    title: title,
    notes: []
  };
  notebooks.push(newNotebook);
  localStorage.setItem('notebooks', JSON.stringify(notebooks));
  titleInput.value = '';
  loadNotebooks();
}

function openNotebook(notebookId) {
  // Save current notebook ID to localStorage
  localStorage.setItem('lastOpenedNotebook', notebookId);
  
  currentNotebookId = notebookId;
  document.getElementById('notebooksView').style.display = 'none';
  document.getElementById('notebookNotesView').style.display = 'block';
  const notebooks = JSON.parse(localStorage.getItem('notebooks') || '[]');
  const notebook = notebooks.find(nb => nb.id === notebookId);
  if (notebook) {
    document.getElementById('notebookTitleHeader').innerText = notebook.title;
    renderNotebookNotes(notebook.notes);
  }
}

function backToNotebooks() {
  // Clear last opened notebook from localStorage
  localStorage.removeItem('lastOpenedNotebook');
  
  currentNotebookId = null;
  editingNoteId = null;
  document.getElementById('notebooksView').style.display = 'block';
  document.getElementById('notebookNotesView').style.display = 'none';
  loadNotebooks();
}

function createNoteInNotebook() {
  const contentField = document.getElementById('notebookNoteContent');
  const rawContent = contentField.value.trim();
  if (!rawContent) {
    alert('Please enter some content for the note.');
    return;
  }
  const notebooks = JSON.parse(localStorage.getItem('notebooks') || '[]');
  const notebook = notebooks.find(nb => nb.id === currentNotebookId);
  if (notebook) {
    const note = {
      id: Date.now(),
      content: rawContent,
      timestamp: new Date().toLocaleDateString('en-GB')
    };
    notebook.notes.push(note);
    localStorage.setItem('notebooks', JSON.stringify(notebooks));
    contentField.value = '';
    renderNotebookNotes(notebook.notes);
  }
}

function renderNotebookNotes(notes) {
  const container = document.getElementById('notebookNotes');
  if (notes.length === 0) {
    container.innerHTML = '<p>No notes in this notebook. Add one!</p>';
  } else {
    container.innerHTML = notes.map(note => {
      if (note.id === editingNoteId) {
        return `
          <div class="note" id="note-${note.id}">
            <textarea id="editTextarea-${note.id}" style="width:100%; padding:10px;">${note.content}</textarea>
            <button onclick="saveEditedNotebookNote(${note.id})" class="edit-btn" title="Save">&#10004;</button>
          </div>
        `;
      } else {
        return `
          <div class="note" id="note-${note.id}">
            <div class="note-buttons" style="position:absolute; top:10px; right:10px; display:flex; gap:5px;">
              <button class="delete-btn" onclick="deleteNotebookNote(${note.id})"><i class="fas fa-trash"></i></button>
              <button class="edit-btn" onclick="editNotebookNote(${note.id})" title="Edit">&#9998;</button>
            </div>
            <div class="note-content">${note.content}</div>
            <small>${note.timestamp}</small>
          </div>
        `;
      }
    }).join('');
  }
}

function editNotebookNote(noteId) {
  const notebooks = JSON.parse(localStorage.getItem('notebooks') || '[]');
  const notebook = notebooks.find(nb => nb.id === currentNotebookId);
  if (notebook) {
    const note = notebook.notes.find(n => n.id === noteId);
    if (note) {
      editingNoteId = noteId;
      renderNotebookNotes(notebook.notes);
    }
  }
}

function saveEditedNotebookNote(noteId) {
  const textArea = document.getElementById(`editTextarea-${noteId}`);
  if (!textArea) return;
  const newContent = textArea.value.trim();
  if (newContent === "") {
    alert("Note cannot be empty.");
    return;
  }
  const notebooks = JSON.parse(localStorage.getItem('notebooks') || '[]');
  const notebook = notebooks.find(nb => nb.id === currentNotebookId);
  if (notebook) {
    const note = notebook.notes.find(n => n.id === noteId);
    if (note) {
      note.content = newContent;
      localStorage.setItem('notebooks', JSON.stringify(notebooks));
      editingNoteId = null;
      renderNotebookNotes(notebook.notes);
    }
  }
}

function deleteNotebookNote(noteId) {
  if (!confirm("Are you sure you want to delete this note?")) return;
  const notebooks = JSON.parse(localStorage.getItem('notebooks') || '[]');
  const notebook = notebooks.find(nb => nb.id === currentNotebookId);
  if (notebook) {
    notebook.notes = notebook.notes.filter(note => note.id !== noteId);
    localStorage.setItem('notebooks', JSON.stringify(notebooks));
    renderNotebookNotes(notebook.notes);
  }
}

function deleteNotebook(e, notebookId) {
  e.stopPropagation();
  if (confirm("Are you sure you want to delete this notebook?")) {
    let notebooks = JSON.parse(localStorage.getItem('notebooks') || '[]');
    notebooks = notebooks.filter(nb => nb.id !== notebookId);
    localStorage.setItem('notebooks', JSON.stringify(notebooks));
    loadNotebooks();
  }
}

/* ============ Checklist Group Feature ============ */
function loadChecklistGroups() {
  const groups = JSON.parse(localStorage.getItem('checklistGroups') || '[]');
  renderChecklistGroups(groups);
}

function renderChecklistGroups(groups) {
  const groupsList = document.getElementById('checklistGroupsList');
  if (groups.length === 0) {
    groupsList.innerHTML = '<p>No checklist groups found. Please create one.</p>';
  } else {
    groupsList.innerHTML = groups.map(group => `
      <div class="checklist-group">
        <h3 onclick="openChecklistGroup(${group.id})">${group.title}</h3>
        <button class="delete-btn" onclick="deleteChecklistGroup(event, ${group.id})"><i class="fas fa-trash"></i></button>
      </div>
    `).join('');
  }
}

function createChecklistGroup() {
  const input = document.getElementById('checklistGroupTitleInput');
  const title = input.value.trim();
  if (!title) {
    alert('Please enter a checklist group title.');
    return;
  }
  const groups = JSON.parse(localStorage.getItem('checklistGroups') || '[]');
  const newGroup = {
    id: Date.now(),
    title: title,
    notes: []
  };
  groups.push(newGroup);
  localStorage.setItem('checklistGroups', JSON.stringify(groups));
  input.value = '';
  loadChecklistGroups();
}

function openChecklistGroup(groupId) {
  currentChecklistGroupId = groupId;
  document.getElementById('checklistGroupsView').style.display = 'none';
  document.getElementById('checklistGroupNotesView').style.display = 'block';
  const groups = JSON.parse(localStorage.getItem('checklistGroups') || '[]');
  const group = groups.find(g => g.id === groupId);
  if (group) {
    document.getElementById('checklistGroupTitleHeader').innerText = group.title;
    renderChecklistGroupNotes(group.notes);
  }
}

function backToChecklistGroups() {
  currentChecklistGroupId = null;
  document.getElementById('checklistGroupsView').style.display = 'block';
  document.getElementById('checklistGroupNotesView').style.display = 'none';
  loadChecklistGroups();
}

function createChecklistNoteInGroup() {
  const contentField = document.getElementById('checklistNoteContent');
  const rawContent = contentField.value.trim();
  if (!rawContent) {
    alert('Please enter some content for the checklist note.');
    return;
  }
  const lines = rawContent.split('\n').map(line => line.trim()).filter(line => line !== '');
  const note = {
    id: Date.now(),
    content: lines,
    checkedItems: Array(lines.length).fill(false),
    timestamp: new Date().toLocaleDateString('en-GB')
  };
  const groups = JSON.parse(localStorage.getItem('checklistGroups') || '[]');
  const group = groups.find(g => g.id === currentChecklistGroupId);
  if (group) {
    group.notes.push(note);
    localStorage.setItem('checklistGroups', JSON.stringify(groups));
    contentField.value = '';
    renderChecklistGroupNotes(group.notes);
  }
}

function renderChecklistGroupNotes(notes) {
  const container = document.getElementById('checklistGroupNotes');
  if (notes.length === 0) {
    container.innerHTML = '<p>No checklist notes in this group. Add one!</p>';
  } else {
    container.innerHTML = notes.map(note => `
      <div class="note" id="note-${note.id}">
        <button class="delete-btn" onclick="deleteChecklistGroupNote(${note.id})"><i class="fas fa-trash"></i></button>
        <div class="note-content">
          ${note.content.map((item, idx) => `
            <label class="checklist-item">
              <input type="checkbox" onchange="toggleChecklistItem(${note.id}, ${idx}, this.checked)" ${note.checkedItems[idx] ? 'checked' : ''}>
              <span>${item}</span>
            </label>
          `).join('')}
        </div>
        <small>${note.timestamp}</small>
      </div>
    `).join('');
  }
}

function toggleChecklistItem(noteId, itemIndex, newState) {
  const groups = JSON.parse(localStorage.getItem('checklistGroups') || '[]');
  const group = groups.find(g => g.id === currentChecklistGroupId);
  if (group) {
    const note = group.notes.find(n => n.id === noteId);
    if (note) {
      if (!Array.isArray(note.checkedItems)) {
        note.checkedItems = Array(note.content.length).fill(false);
      }
      note.checkedItems[itemIndex] = newState;
      localStorage.setItem('checklistGroups', JSON.stringify(groups));
      renderChecklistGroupNotes(group.notes);
    }
  }
}

function deleteChecklistGroupNote(noteId) {
  if (!confirm("Are you sure you want to delete this checklist note?")) return;
  const groups = JSON.parse(localStorage.getItem('checklistGroups') || '[]');
  const group = groups.find(g => g.id === currentChecklistGroupId);
  if (group) {
    group.notes = group.notes.filter(note => note.id !== noteId);
    localStorage.setItem('checklistGroups', JSON.stringify(groups));
    renderChecklistGroupNotes(group.notes);
  }
}

function deleteChecklistGroup(e, groupId) {
  e.stopPropagation();
  if (confirm("Are you sure you want to delete this checklist group?")) {
    let groups = JSON.parse(localStorage.getItem('checklistGroups') || '[]');
    groups = groups.filter(g => g.id !== groupId);
    localStorage.setItem('checklistGroups', JSON.stringify(groups));
    loadChecklistGroups();
  }
}

/* ============ Image Upload & Compression Feature ============ */
// Open (or create) the database
const request = indexedDB.open("ImageDB", 1);

request.onupgradeneeded = function(event) {
  const db = event.target.result;
  db.createObjectStore("images", { keyPath: "id" });
};

request.onsuccess = function(event) {
  db = event.target.result; // Assign db to the global variable
  console.log("Database opened successfully");
  loadImages(); // Load images after DB is ready
};

request.onerror = function(event) {
  console.error("Database error:", event.target.error);
};

function saveImageToIndexedDB(image) {
  const transaction = db.transaction(["images"], "readwrite");
  const store = transaction.objectStore("images");
  const request = store.add(image);

  request.onsuccess = function() {
    console.log("Image saved successfully!");
    loadImages(); // Load images after saving
  };

  request.onerror = function() {
    console.error("Error saving image:", request.error);
  };
}

function uploadImage() {
  const imageInput = document.getElementById('imageInput');
  if (imageInput.files.length === 0) {
    alert("Please select at least one image file.");
    return;
  }

  const promises = Array.from(imageInput.files).map(file => {
    return new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = function(e) {
        const image = {
          id: Date.now() + Math.random(),
          data: e.target.result,
          timestamp: new Date().toLocaleDateString('en-GB')
        };
        saveImageToIndexedDB(image);
        resolve();
      };
      reader.onerror = function() {
        console.error("Error reading file:", reader.error);
        reject(reader.error);
      };
      reader.readAsDataURL(file);
    });
  });

  Promise.all(promises)
    .then(() => {
      loadImages();
    })
    .catch(error => {
      console.error("Error uploading images:", error);
    });

  imageInput.value = ""; // Clear the input after upload
}

function loadImages() {
  const transaction = db.transaction(["images"], "readonly");
  const store = transaction.objectStore("images");
  const request = store.getAll(); // Get all images

  request.onsuccess = function(event) {
    const images = event.target.result;
    renderImages(images); // Pass images to renderImages
  };

  request.onerror = function() {
    console.error("Error loading images:", request.error);
  };
}

function renderImages(images) {
  const container = document.getElementById('gallery');
  if (!container) return;
  if (images.length === 0) {
    container.innerHTML = '<p>No images uploaded yet.</p>';
  } else {
    container.innerHTML = images.map(image => `
      <div class="image-item" id="image-${image.id}">
        <img src="${image.data}" alt="Uploaded Image" loading="lazy" onclick="openImage('${image.data}')" />
        <div class="image-info">
          <div style="display: flex; align-items: center; justify-content: space-between;">
            <small class="image-timestamp">${image.timestamp}</small>
            <div class="buttons" style="display: flex; align-items: center;">
              <button class="edit-btn" onclick="editImage(${image.id})" style="background-color: #2196F3; color: white; border: none; border-radius: 5px; padding: 5px; ">
                <i class="fas fa-edit"></i>
              </button>
              <button class="delete-btn" onclick="deleteImage(${image.id}); event.stopPropagation();" style="background-color: grey; color: white; border: none; border-radius: 5px; padding: 5px;">
                <i class="fas fa-trash"></i> dlt
              </button>
            </div>
          </div>
        </div>
      </div>
    `).join('');
  }
}

function openImage(imageData) {
  const currentTime = new Date().getTime();
  const tapDelay = 300; // Time in milliseconds to consider as a double tap

  if (currentTime - lastTapTime < tapDelay) {
    // If the time between taps is less than the delay, it's a double tap
    const imageViewer = document.createElement('div');
    imageViewer.style.position = 'fixed';
    imageViewer.style.top = '0';
    imageViewer.style.left = '0';
    imageViewer.style.width = '100%';
    imageViewer.style.height = '100%';
    imageViewer.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
    imageViewer.style.display = 'flex';
    imageViewer.style.alignItems = 'center';
    imageViewer.style.justifyContent = 'center';
    imageViewer.innerHTML = `
      <img src="${imageData}" style="max-width: 90%; max-height: 90%;" onclick="this.parentElement.remove();" />
    `;
    document.body.appendChild(imageViewer);
  }

  lastTapTime = currentTime; // Update the last tap time
}

function deleteImage(id) {
  // Add confirmation dialog
  if (!confirm("Are you sure you want to delete this image?")) {
    return; // Exit if the user cancels
  }
  
  if (confirm("Are you sure you want to delete this image?")) {
    const transaction = db.transaction(["images"], "readwrite");
    const store = transaction.objectStore("images");
    const request = store.delete(id);

    request.onsuccess = function() {
      console.log("Image deleted successfully!");
      loadImages(); // Reload images after deletion
    };

    request.onerror = function() {
      console.error("Error deleting image:", request.error);
    };
  } else {
    console.log("Image deletion canceled.");
  }
}

/* ============ Backup Feature ============ */
async function exportData() {
  const images = await loadAllImages(); // Load images before exporting
  const data = {
    notes: localStorage.getItem('notes') || null,
    notebooks: localStorage.getItem('notebooks') || null,
    checklistGroups: localStorage.getItem('checklistGroups') || null,
    images: JSON.stringify(images), // Save images as JSON
    lockedSectionPassword: localStorage.getItem('lockedSectionPassword') || null
  };
  const dataStr = JSON.stringify(data, null, 2);
  const blob = new Blob([dataStr], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'smart-note-taker-backup.json';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
}

async function loadAllImages() {
  return new Promise((resolve, reject) => {
    const transaction = db.transaction(["images"], "readonly");
    const store = transaction.objectStore("images");
    const request = store.getAll(); // Get all images

    request.onsuccess = function(event) {
      resolve(event.target.result); // Return images
    };

    request.onerror = function() {
      reject("Error loading images:", request.error);
    };
  });
}

function importData(file) {
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      
      // Validate the structure of the data
      if (typeof data.notes === 'string') {
        localStorage.setItem('notes', data.notes);
      } else {
        throw new Error("Invalid notes format");
      }

      if (typeof data.notebooks === 'string') {
        localStorage.setItem('notebooks', data.notebooks);
      } else {
        throw new Error("Invalid notebooks format");
      }

      if (typeof data.checklistGroups === 'string') {
        localStorage.setItem('checklistGroups', data.checklistGroups);
      } else {
        throw new Error("Invalid checklist groups format");
      }

      if (data.images !== undefined) {
        const images = JSON.parse(data.images);
        if (Array.isArray(images)) {
          images.forEach(image => saveImageToIndexedDB(image)); // Save each image to IndexedDB
        } else {
          throw new Error("Invalid images format");
        }
      }

      if (data.lockedSectionPassword !== undefined) {
        localStorage.setItem('lockedSectionPassword', data.lockedSectionPassword);
      }

      alert("Data imported successfully! Reloading the page...");
      location.reload();
    } catch (err) {
      alert("Failed to import data: " + err.message);
    }
  };
  reader.readAsText(file);
}

/* ============ Initial Loads ============ */
function initializeApp() {
  request.onsuccess = function(event) {
    db = event.target.result; // Assign db to the global variable
    loadNotebooks();
    renderNotes();
    loadChecklistGroups();
    loadImages(); // Load images when the app initializes

    // Restore last opened section
    const lastSection = localStorage.getItem('lastOpenedSection') || 'regular';
    showSection(lastSection);

    // Restore last opened notebook if any
    const lastNotebook = localStorage.getItem('lastOpenedNotebook');
    if (lastSection === 'regular' && lastNotebook) {
      openNotebook(parseInt(lastNotebook));
    }
  };
}

const VAULT_KEY = 'secureImageVault';
            const MASTER_PASSWORD_KEY = 'masterPassword';
            let currentPassword = '';
            let db;
            let googleUser = null;
            let googleDriveToken = null;
            let clickTimer; // Timer for click detection
            const clickDelay = 300; // Delay in milliseconds to differentiate between single and double clicks

            // Initialize IndexedDB
            function initDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('ImageVaultDB', 1);

                    request.onerror = (event) => {
                        console.error('Database error:', event.target.error);
                        reject('Could not open database');
                    };

                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('images')) {
                            db.createObjectStore('images', { keyPath: 'id', autoIncrement: true });
                        }
                    };

                    request.onsuccess = (event) => {
                        db = event.target.result;
                        console.log('Database opened successfully');
                        resolve(db);
                    };
                });
            }

            // Initialize DB when page loads
            initDB().catch(error => {
                console.error('Failed to initialize database:', error);
                alert('Failed to initialize database. Please refresh the page.');
            });

            // Initialize Google Sign-in
            function initGoogleSignIn() {
                gapi.load('client:auth2', async function() {
                    try {
                        await gapi.client.init({
                            apiKey: 'AIzaSyDJTRZzhv1o7WnBVXMZP0mHOGggkns189A',
                            clientId: '637709229002-0uaqiflhu41koahqpfcgosn36gee5ud5.apps.googleusercontent.com',
                            scope: 'https://www.googleapis.com/auth/drive.file email profile',
                            plugin_name: 'Image Vault',
                            cookiepolicy: 'single_host_origin'
                        });

                        // Check if user is already signed in
                        const auth2 = gapi.auth2.getAuthInstance();
                        if (auth2.isSignedIn.get()) {
                            handleSignIn(auth2.currentUser.get());
                        }
                        
                        console.log('Google API initialized successfully');
                    } catch (error) {
                        console.log('Google Sign-In not available:', error);
                    }
                });
            }

            // Add new function to handle sign in
            async function signInWithGoogle() {
                try {
                    showLoading();
                    const googleUser = await gapi.auth2.getAuthInstance().signIn();
                    await handleSignIn(googleUser);
                } catch (error) {
                    console.error('Sign-in error:', error);
                    alert('Failed to sign in with Google. Please try again.');
                } finally {
                    hideLoading();
                }
            }

            // Add new function to handle successful sign in
            async function handleSignIn(googleUser) {
                try {
                    const profile = googleUser.getBasicProfile();
                    const email = profile.getEmail();
                    const token = googleUser.getAuthResponse().access_token;
                    
                    // Save user info
                    localStorage.setItem(MASTER_PASSWORD_KEY, email);
                    currentPassword = email;
                    googleDriveToken = token;
                    
                    // Update UI
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('mainContent').classList.remove('hidden');
                    document.getElementById('logoutBtn').classList.remove('hidden');
                    
                    // Load images
                    await loadImages();
                    
                    console.log('Successfully signed in:', email);
                } catch (error) {
                    console.error('Error handling sign in:', error);
                    alert('Error processing sign in. Please try again.');
                }
            }

            function initializeVault() {
                const password = document.getElementById('passwordInput').value;
                if (!password) {
                    alert('Please enter a password!');
                    return;
                }

                const storedMasterPassword = localStorage.getItem(MASTER_PASSWORD_KEY);
                
                if (!storedMasterPassword) {
                    const confirmPassword = prompt('First time setup: Please confirm your password');
                    if (password !== confirmPassword) {
                        alert('Passwords do not match! Please try again.');
                        return;
                    }
                    localStorage.setItem(MASTER_PASSWORD_KEY, password);
                    alert('Password set successfully! You can now use this password to access your vault.');
                } else if (password !== storedMasterPassword) {
                    alert('Incorrect password! Please try again.');
                    return;
                }

                currentPassword = password;
                loadImages();

                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('deleteAllBtn').style.display = 'block';
            }

            async function uploadImages() {
                const files = document.getElementById('imageInput').files;
                if (!files.length) {
                    alert('No files selected for upload.');
                    return;
                }

                showLoading();
                let uploadedCount = 0;

                try {
                    for (let file of files) {
                        if (file.size > 30 * 1024 * 1024) {
                            hideLoading();
                            alert(`File "${file.name}" is too large! Maximum size per file is 30MB.`);
                            document.getElementById('imageInput').value = '';
                            return;
                        }

                        // Read file
                        const imageData = await readFileAsDataURL(file);
                        
                        // Save to IndexedDB
                        await saveToIndexedDB({
                            name: file.name,
                            data: imageData,
                            timestamp: new Date().toISOString(),
                            password: currentPassword
                        });

                        // Backup to Google Drive if signed in
                        if (googleDriveToken) {
                            await backupToGoogleDrive(file);
                        }

                        uploadedCount++;
                    }

                    document.getElementById('imageInput').value = '';
                    hideLoading();
                    alert(`Successfully uploaded ${uploadedCount} images!`);
                    loadImages();
                } catch (error) {
                    console.error('Upload Error:', error);
                    hideLoading();
                    alert('Error uploading images. Please try again.');
                }
            }

            // Helper function to read file
            function readFileAsDataURL(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = e => reject(e);
                    reader.readAsDataURL(file);
                });
            }

            // Save to IndexedDB
            function saveToIndexedDB(imageData) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(['images'], 'readwrite');
                    const store = transaction.objectStore('images');
                    const request = store.add(imageData);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }

            // Backup to Google Drive
            async function backupToGoogleDrive(file) {
                const metadata = {
                    name: file.name,
                    mimeType: file.type,
                    parents: ['appDataFolder'] // Store in app-specific folder
                };

                const form = new FormData();
                form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
                form.append('file', file);

                await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${googleDriveToken}`
                    },
                    body: form
                });
            }

            async function loadImages() {
                if (!db) {
                    console.error('Database not initialized');
                    return;
                }

                showLoading();

                try {
                    // Load from IndexedDB
                    const localImages = await loadFromIndexedDB();
                    
                    // Load from Google Drive if signed in
                    let driveImages = [];
                    if (googleDriveToken) {
                        driveImages = await loadFromGoogleDrive();
                    }

                    // Combine and sort images
                    allImages = [...localImages, ...driveImages].sort((a, b) => 
                        new Date(b.timestamp) - new Date(a.timestamp)
                    );

                    renderGallery(allImages);
                } catch (error) {
                    console.error('Error loading images:', error);
                    alert('Error loading images. Please try again.');
                } finally {
                    hideLoading();
                }
            }

            // Load from IndexedDB
            function loadFromIndexedDB() {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(['images'], 'readonly');
                    const store = transaction.objectStore('images');
                    const request = store.getAll();
                    
                    request.onsuccess = () => {
                        const images = request.result.filter(img => img.password === currentPassword);
                        // Get saved names from localStorage
                        const savedNames = JSON.parse(localStorage.getItem('imageNames') || '{}');
                        
                        // Apply saved names to images
                        images.forEach(img => {
                            if (savedNames[img.id]) {
                                img.name = savedNames[img.id];
                            }
                        });
                        
                        resolve(images);
                    };
                    
                    request.onerror = () => reject(request.error);
                });
            }

            // Load from Google Drive
            async function loadFromGoogleDrive() {
                const response = await gapi.client.drive.files.list({
                    spaces: 'appDataFolder',
                    fields: 'files(id, name, modifiedTime, webContentLink)'
                });

                return response.result.files.map(file => ({
                    id: file.id,
                    name: file.name,
                    timestamp: file.modifiedTime,
                    data: file.webContentLink,
                    password: currentPassword
                }));
            }

            function renderGallery(images) {
                const gallery = document.getElementById('gallery');
                if (!images.length) {
                    gallery.innerHTML = `
                        <div class="empty-gallery">
                            <i class="fas fa-images"></i>
                            <h3>No images found</h3>
                            <p>Upload some images to get started!</p>
                        </div>`;
                    return;
                }

                gallery.innerHTML = '';
                images.forEach(img => {
                    const card = document.createElement('div');
                    card.className = 'image-card';
                    card.innerHTML = `
                        <img src="${img.data}" alt="${img.name}" onclick="openModal(this.src)">
                        <div class="image-info">
                            <div class="name-edit-container">
                                <span class="image-name">${img.name}</span>
                                <input type="text" class="edit-name-input" value="${img.name}">
                            </div>
                            <div class="buttons">
                                <button class="edit-btn" onclick="startEdit(this)">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="save-btn" onclick="saveEdit(this, ${img.id})">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="cancel-btn" onclick="cancelEdit(this)">
                                    <i class="fas fa-times"></i>
                                </button>
                                <button id="delete-btn" onclick="deleteImage(${img.id})">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    gallery.appendChild(card);
                });
            }

            function openModal(src) {
                const modal = document.getElementById('imageModal');
                const modalImg = document.getElementById('modalImage');
                modal.classList.add('active');
                modalImg.src = src;
            }

            function closeModal() {
                const modal = document.getElementById('imageModal');
                modal.classList.remove('active');
            }

            function startEdit(btn) {
                const container = btn.closest('.image-info');
                const nameSpan = container.querySelector('.image-name');
                const input = container.querySelector('.edit-name-input');
                const saveBtn = container.querySelector('.save-btn');
                const cancelBtn = container.querySelector('.cancel-btn');
                
                nameSpan.style.display = 'none';
                input.style.display = 'block';
                btn.style.display = 'none';
                saveBtn.classList.add('show');
                cancelBtn.classList.add('show');
                input.focus();
            }

            function cancelEdit(btn) {
                const container = btn.closest('.image-info');
                const nameSpan = container.querySelector('.image-name');
                const input = container.querySelector('.edit-name-input');
                const editBtn = container.querySelector('.edit-btn');
                const saveBtn = container.querySelector('.save-btn');
                const cancelBtn = container.querySelector('.cancel-btn');
                
                nameSpan.style.display = 'block';
                input.style.display = 'none';
                editBtn.style.display = 'flex';
                saveBtn.classList.remove('show');
                cancelBtn.classList.remove('show');
            }

            async function saveEdit(btn, imageId) {
                const container = btn.closest('.image-info');
                const nameSpan = container.querySelector('.image-name');
                const input = container.querySelector('.edit-name-input');
                const newName = input.value.trim();
                
                if (!newName) {
                    alert('Please enter a valid name');
                    return;
                }

                try {
                    // Save to localStorage
                    const savedNames = JSON.parse(localStorage.getItem('imageNames') || '{}');
                    savedNames[imageId] = newName;
                    localStorage.setItem('imageNames', JSON.stringify(savedNames));

                    // Update UI
                    nameSpan.textContent = newName;
                    cancelEdit(btn);
                } catch (error) {
                    console.error('Error saving name:', error);
                    alert('Error saving name. Please try again.');
                }
            }

            async function deleteImage(imageId) {
                // Add confirmation dialog
                if (!confirm("Are you sure you want to delete this image?")) {
                    return; // Exit if the user cancels
                }
                
                showLoading();
                try {
                    // Delete from IndexedDB
                    await deleteFromIndexedDB(imageId);
                    
                    // Delete from Google Drive if signed in
                    if (googleDriveToken) {
                        await deleteFromGoogleDrive(imageId);
                    }

                    // Remove saved name
                    const savedNames = JSON.parse(localStorage.getItem('imageNames') || '{}');
                    delete savedNames[imageId];
                    localStorage.setItem('imageNames', JSON.stringify(savedNames));

                    await loadImages();
                } catch (error) {
                    console.error('Error deleting image:', error);
                    alert('Error deleting image. Please try again.');
                } finally {
                    hideLoading();
                }
            }

            function deleteFromIndexedDB(imageId) {
                return new Promise((resolve, reject) => {
                    const transaction = db.transaction(['images'], 'readwrite');
                    const store = transaction.objectStore('images');
                    const request = store.delete(imageId);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }

            async function deleteFromGoogleDrive(fileId) {
                await gapi.client.drive.files.delete({
                    fileId: fileId
                });
            }

            let currentSort = 'date';
            function sortImages(type) {
                if (type === currentSort) return;
                
                currentSort = type;
                const buttons = document.querySelectorAll('.sort-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                event.currentTarget.classList.add('active');

                const gallery = document.getElementById('gallery');
                const cards = Array.from(gallery.children);
                
                cards.sort((a, b) => {
                    const aInfo = a.querySelector('.image-name').textContent;
                    const bInfo = b.querySelector('.image-name').textContent;
                    
                    switch(type) {
                        case 'name':
                            return aInfo.localeCompare(bInfo);
                        case 'date':
                            return new Date(b.dataset.timestamp) - new Date(a.dataset.timestamp);
                        case 'size':
                            return parseInt(b.dataset.size) - parseInt(a.dataset.size);
                        default:
                            return 0;
                    }
                });

                gallery.innerHTML = '';
                cards.forEach(card => gallery.appendChild(card));
            }

            function showLoading() {
                document.getElementById('loading').classList.add('active');
            }

            function hideLoading() {
                document.getElementById('loading').classList.remove('active');
            }

            // Add event listener for double-click
            document.getElementById('deleteAllBtn').addEventListener('click', function() {
                if (clickTimer) {
                    clearTimeout(clickTimer); // Clear the timer if it's already set
                    clickTimer = null; // Reset the timer
                    confirmDeleteAll(); // Call the delete function on double-click
                } else {
                    clickTimer = setTimeout(() => {
                        clickTimer = null; // Reset the timer after delay
                    }, clickDelay);
                }
            });

            function confirmDeleteAll() {
                // Show confirmation dialog only once
                if (confirm('Are you sure you want to delete all images? This action cannot be undone.')) {
                    deleteAllImages();
                }
            }

            async function deleteAllImages() {
                showLoading();
                try {
                    // Get all images from IndexedDB
                    const images = await loadFromIndexedDB();
                    const deletePromises = images.map(image => deleteImage(image.id)); // Create an array of promises

                    // Wait for all delete operations to complete
                    await Promise.all(deletePromises);

                    // Optionally, delete from Google Drive if signed in
                    if (googleDriveToken) {
                        const deleteDrivePromises = images.map(image => deleteFromGoogleDrive(image.id)); // Create an array of promises
                        await Promise.all(deleteDrivePromises);
                    }

                    alert('All images have been deleted successfully!');
                    loadImages(); // Refresh the gallery after deletion
                } catch (error) {
                    console.error('Error deleting all images:', error);
                    alert('Error deleting images. Please try again.');
                } finally {
                    hideLoading();
                }
            }

            // Initialize Google Sign-in when page loads
            window.onload = initGoogleSignIn;



// Replace the existing initial loads with initializeApp()
window.onload = initializeApp;

  </script>
</body>
</html>