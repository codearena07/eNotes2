<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>eNotes</title>
  <link rel="shortcut icon" href="img1.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #3b82f6;
      --primary-hover: #2563eb;
      --background: #111827;
      --card-bg: #1a2234;
      --border-color: #2a3349;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --danger: #ef4444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    body {
      background-color: var(--background);
      color: var(--text-primary);
      min-height: 100vh;
    }

    /* Header Styles */
    header {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0.8rem;
      background-color: var(--card-bg);
      border-bottom: 1px solid #2d3748;
    }

    .logo {
      color: var(--primary);
      font-size: 1.75rem;
      font-weight: 700;
    }

    /* Main Content Styles */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0.5rem;
    }

    /* Tab Navigation */
    .tabs {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.25rem;
      margin-bottom: 1rem;
      border-radius: 0.5rem;
      overflow: hidden;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .tab {
      padding: 0.5rem;
      text-align: center;
      background-color: var(--card-bg);
      color: var(--text-secondary);
      cursor: pointer;
      transition: background-color 0.3s, color 0.3s;
      border: none;
      font-size: 0.875rem;
      font-weight: 500;
    }

    .tab.active {
      background-color: var(--primary);
      color: white;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      max-width: 900px;
      margin: 0 auto;
    }

    .tab-content.active {
      display: block;
    }

    /* Card Styles */
    .card {
      background-color: var(--card-bg);
      border-radius: 0.5rem;
      overflow: hidden;
      margin-bottom: 0.75rem;
      border: 1px solid #2d3748;
      max-width: 100%;
    }

    .card-header {
      padding: 0.6rem;
      border-bottom: 1px solid #2d3748;
    }

    .card-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .card-content {
      padding: 0.6rem;
    }

    .card-footer {
      padding: 0.6rem;
      border-top: 1px solid #2d3748;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    /* Form Elements */
    input, textarea {
      width: 100%;
      padding: 0.6rem;
      background-color: var(--border-color);
      border: 1px solid #4a5568;
      border-radius: 0.375rem;
      color: var(--text-primary);
      font-size: 0.875rem;
    }

    input:focus, textarea:focus {
      outline: 2px solid var(--primary);
      border-color: var(--primary);
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .input-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
    }

    /* Button Styles */
    .btn {
      padding: 0.4rem 0.8rem;
      border-radius: 0.375rem;
      border: none;
      cursor: pointer;
      font-size: 0.875rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background-color 0.3s, transform 0.2s;
      align-self: center;
      justify-self: center;
    }

    .btn-primary {
      background-color: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-hover);
    }

    .btn-icon {
      width: 1.8rem;
      height: 1.8rem;
      padding: 0;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-ghost {
      background-color: transparent;
      color: var(--text-secondary);
    }

    .btn-ghost:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    .btn-danger {
      background-color: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background-color: #dc2626;
    }

    /* Grid Layouts */
    .grid {
      display: grid;
      gap: 0.75rem;
    }

    /* Modified grid layouts for more compact display */
    .grid-cols-1 {
      grid-template-columns: repeat(2, 1fr);
    }

    @media (min-width: 640px) {
      .grid-cols-2 {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (min-width: 1024px) {
      .grid-cols-3 {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    /* Notebook Styles */
    .notebook {
      position: relative;
      cursor: pointer;
    }

    .notebook-title {
      margin-right: 1.5rem;
      font-size: 0.9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .notebook-count {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    /* Note Styles */
    .note {
      position: relative;
      padding-top: 1.8rem;
    }

    .note-content {
      white-space: pre-wrap;
      word-break: break-word;
      font-size: 0.85rem;
    }

    .note-timestamp {
      font-size: 0.7rem;
      color: var(--text-secondary);
    }

    .note-actions {
      position: absolute;
      top: 0.3rem;
      right: 0.3rem;
      display: flex;
      gap: 0.25rem;
    }

    /* Back Button */
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.75rem;
      font-size: 0.85rem;
    }

    /* Upload Button */
    .upload-btn {
      width: 100%;
      height: 5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background-color: var(--primary);
      color: white;
      border-radius: 0.375rem;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .upload-btn:hover {
      background-color: var(--primary-hover);
    }

    /* Image Gallery */
    .image-card img {
      width: 100%;
      height: 8rem; /* Reduced height for more compact display */
      object-fit: cover;
      background-color: #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4a5568;
      cursor: pointer;
    }

    /* Locked Notes */
    .password-input {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
    }

    /* Checklist Styles */
    .checklist-item {
      display: flex;
      align-items: center;
      padding: 0.4rem;
      background-color: rgba(255, 255, 255, 0.05);
      border-radius: 0.375rem;
      margin-bottom: 0.4rem;
      font-size: 0.85rem;
    }

    .checklist-item input[type="checkbox"] {
      width: 1.1rem;
      height: 1.1rem;
      margin-right: 0.5rem;
      cursor: pointer;
      -webkit-appearance: none;
      appearance: none;
      background-color: transparent;
      border: 2px solid #fff;
      border-radius: 0.25rem;
      position: relative;
      transition: background 0.3s, border-color 0.3s;
    }

    .checklist-item input[type="checkbox"]:checked {
      background: var(--primary);
      border-color: var(--primary);
    }

    .checklist-item input[type="checkbox"]:checked::after {
      content: "âœ“";
      position: absolute;
      top: -0.125rem;
      left: 0.2rem;
      color: #fff;
      font-size: 0.9rem;
      font-weight: bold;
    }

    .checklist-item span {
      flex: 1;
      color: var(--text-primary);
      font-size: 0.85rem;
    }

    /* Modal Styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      display: none;
    }

    .modal {
      background-color: var(--card-bg);
      border-radius: 0.5rem;
      width: 90%;
      max-width: 500px;
      padding: 1.2rem;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
    }

    .modal-title {
      font-size: 1.1rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.3rem;
      cursor: pointer;
    }

    .modal-body {
      margin-bottom: 1.2rem;
    }

    .modal-footer {
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }

    /* Fullscreen Image Viewer */
    .fullscreen-image {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.9);
      z-index: 2000;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .fullscreen-image img {
      max-width: 90%;
      max-height: 80vh;
      object-fit: contain;
    }

    .fullscreen-image-info {
      color: white;
      margin-top: 0.75rem;
      font-size: 0.9rem;
    }

    .fullscreen-close {
      position: absolute;
      top: 15px;
      right: 15px;
      background: rgba(0, 0, 0, 0.5);
      color: white;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: none;
      font-size: 1.3rem;
    }

    /* Backup/Import Buttons */
    .backup-import-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .backup-btn, .import-btn {
      padding: 0.4rem 0.8rem;
      border-radius: 0.375rem;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .backup-btn {
      background-color: var(--primary);
      color: white;
      border: none;
    }

    .backup-btn:hover {
      background-color: var(--primary-hover);
    }

    .import-btn {
      background-color: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--text-secondary);
    }

    .import-btn:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--text-primary);
    }

    .import-input {
      display: none;
    }

    /* Truncated Text */
    .truncated-name {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 120px;
      font-size: 0.8rem;
    }

    /* Utility Classes */
    .hidden {
      display: none;
    }

    .flex {
      display: flex;
    }

    .items-center {
      align-items: center;
    }

    .justify-between {
      justify-content: space-between;
    }

    .justify-center {
      justify-content: center;
    }

    .w-full {
      width: 100%;
    }

    .mt-4 {
      margin-top: 0.75rem;
    }

    .mb-4 {
      margin-bottom: 0.75rem;
    }

    .ml-2 {
      margin-left: 0.4rem;
    }

    .mr-2 {
      margin-right: 0.4rem;
    }

    .relative {
      position: relative;
    }

    .absolute {
      position: absolute;
    }

    .top-2 {
      top: 0.4rem;
    }

    .right-2 {
      right: 0.4rem;
    }

    .text-center {
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- Backup/Import Buttons -->
  <div class="backup-import-container">
    <button id="backup-data" class="backup-btn" style="margin: 1%;">
      <i class="fas fa-download"></i>Backup
    </button>
    <div style="margin: 1%;">
      <input type="file" id="import-input" class="import-input" accept=".json">
      <button id="import-data" class="import-btn" >
        <i class="fas fa-upload"></i>Import
      </button>
    </div>
  </div>

  <!-- Header -->
  <header>
    <div style="display: flex; justify-content: center; align-items: center;">
      <h1 class="logo" style="font-size: 180%;">eNotes</h1>
    </div>
  </header>
  
  <!-- Main Content -->
  <div class="container">
    <!-- Tab Navigation -->
    <div class="tabs">
      <button class="tab active" data-tab="regular">Regular</button>
      <button class="tab" data-tab="checklists">Checklists</button>
      <button class="tab" data-tab="locked">Locked</button>
      <button class="tab" data-tab="images">Images</button>
    </div>

    <!-- Regular Notes Tab -->
    <div id="regular" class="tab-content active">
      <!-- Notebooks View -->
      <div id="notebooks-view">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Create New Notebook</h2>
          </div>
          <div class="card-content">
            <div class="input-group">
              <input type="text" id="notebook-title" placeholder="Notebook Title">
              <button id="create-notebook" class="btn btn-primary">
                <i class="fas fa-plus mr-2"></i> Create
              </button>
            </div>
          </div>
        </div>

        <div id="notebooks-list" class="grid grid-cols-1">
          <!-- Notebooks will be added here dynamically -->
        </div>
      </div>

      <!-- Notebook Notes View -->
      <div id="notebook-notes-view" class="hidden">
        <button id="back-to-notebooks" class="btn btn-ghost back-btn">
          <i class="fas fa-arrow-left"></i> Back to Notebooks
        </button>
        <h2 id="current-notebook-title" class="mb-4"></h2>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Add New Note</h2>
          </div>
          <div class="card-content">
            <textarea id="note-content" placeholder="Write your note here..."></textarea>
          </div>
          <div class="card-footer">
            <button id="add-note" class="btn btn-primary">
              <i class="fas fa-plus mr-2"></i> Add Note
            </button>
          </div>
        </div>

        <div id="notes-list" class="grid grid-cols-1 mt-4">
          <!-- Notes will be added here dynamically -->
        </div>
      </div>
    </div>

    <!-- Checklists Tab -->
    <div id="checklists" class="tab-content">
      <!-- Checklist Groups View -->
      <div id="checklist-groups-view">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Create New Checklist Group</h2>
          </div>
          <div class="card-content">
            <div class="input-group">
              <input type="text" id="checklist-group-title" placeholder="Checklist Group Title">
              <button id="create-checklist-group" class="btn btn-primary">
                <i class="fas fa-plus mr-2"></i> Create
              </button>
            </div>
          </div>
        </div>

        <div id="checklist-groups-list" class="grid grid-cols-1">
          <!-- Checklist groups will be added here dynamically -->
        </div>
      </div>

      <!-- Checklist Group Items View -->
      <div id="checklist-group-items-view" class="hidden">
        <button id="back-to-checklist-groups" class="btn btn-ghost back-btn">
          <i class="fas fa-arrow-left"></i> Back to Checklist Groups
        </button>
        <h2 id="current-checklist-group-title" class="mb-4"></h2>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Add New Checklist</h2>
          </div>
          <div class="card-content">
            <textarea id="checklist-items" placeholder="Add checklist items (one per line)"></textarea>
          </div>
          <div class="card-footer">
            <button id="add-checklist" class="btn btn-primary">
              <i class="fas fa-plus mr-2"></i> Add Checklist
            </button>
          </div>
        </div>

        <div id="checklists-list" class="grid grid-cols-1 mt-4">
          <!-- Checklists will be added here dynamically -->
        </div>
      </div>
    </div>

    <!-- Locked Notes Tab -->
    <div id="locked" class="tab-content">
      <div id="locked-auth" class="card" style="max-width: 500px; margin: 0 auto;">
        <div class="card-header">
          <h2 class="card-title">Unlock Locked Notes</h2>
        </div>
        <div class="card-content">
          <p style="color: var(--text-secondary); margin-bottom: 0.75rem; font-size: 0.85rem;">
            Enter your password to view and manage your locked notes.
          </p>
          <div style="margin-bottom: 0.75rem;">
            <label style="display: block; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.85rem;">Password</label>
            <div class="password-input">
              <input type="password" id="locked-password" placeholder="Enter your password">
              <button class="password-toggle" id="toggle-password">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="card-footer">
          <button id="unlock-notes" class="btn btn-primary w-full">
            <i class="fas fa-lock mr-2"></i> Unlock
          </button>
        </div>
      </div>

      <div id="locked-notes-view" class="hidden">
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Add New Locked Note</h2>
          </div>
          <div class="card-content">
            <textarea id="locked-note-content" placeholder="Write your locked note here..."></textarea>
          </div>
          <div class="card-footer">
            <button id="add-locked-note" class="btn btn-primary">
              <i class="fas fa-plus mr-2"></i> Add Locked Note
            </button>
          </div>
        </div>

        <div id="locked-notes-list" class="grid grid-cols-1 mt-4">
          <!-- Locked notes will be added here dynamically -->
        </div>
      </div>

      <!-- Set Password Modal -->
      <div id="set-password-modal" class="modal-overlay">
        <div class="modal">
          <div class="modal-header">
            <h3 class="modal-title">Set Password</h3>
            <button class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <p style="color: var(--text-secondary); margin-bottom: 0.75rem; font-size: 0.85rem;">
              Create a password to protect your locked notes. Remember this password as it will be required to access your notes in the future.
            </p>
            <div style="margin-bottom: 0.75rem;">
              <label style="display: block; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.85rem;">New Password</label>
              <div class="password-input">
                <input type="password" id="new-password" placeholder="Enter a password">
              </div>
            </div>
            <div>
              <label style="display: block; margin-bottom: 0.4rem; color: var(--text-secondary); font-size: 0.85rem;">Confirm Password</label>
              <div class="password-input">
                <input type="password" id="confirm-password" placeholder="Confirm your password">
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="save-password" class="btn btn-primary">Save Password</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Images Tab -->
    <div id="images" class="tab-content">
      <div class="card">
        <div class="card-header">
          <h2 class="card-title text-center">Upload Images</h2>
        </div>
        <div class="card-content">
          <input type="file" id="image-input" accept="image/*" multiple style="display: none;">
          <div class="upload-btn" id="upload-btn">
            <i class="fas fa-upload" style="font-size: 1.3rem;"></i>
            <span>Click to Upload Images</span>
          </div>
        </div>
      </div>

      <div id="images-list" class="grid grid-cols-1 mt-4">
        <!-- Images will be added here dynamically -->
      </div>
    </div>
  </div>

  <!-- Edit Image Name Modal -->
  <div id="edit-image-modal" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Edit Image Name</h3>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <input type="text" id="image-name-input" placeholder="Enter image name">
        <input type="hidden" id="edit-image-id">
      </div>
      <div class="modal-footer">
        <button id="save-image-name" class="btn btn-primary">Save</button>
      </div>
    </div>
  </div>

  <!-- Fullscreen Image Viewer -->
  <div id="fullscreen-image-viewer" class="fullscreen-image">
    <button id="fullscreen-close" class="fullscreen-close">
      <i class="fas fa-times"></i>
    </button>
    <img id="fullscreen-img" src="/placeholder.svg" alt="Fullscreen image">
    <div id="fullscreen-image-info" class="fullscreen-image-info"></div>
  </div>

  <script>
    // Global variables
    let currentTab = 'regular';
    let notebooks = [];
    let currentNotebookId = null;
    let checklistGroups = [];
    let currentChecklistGroupId = null;
    let lockedNotes = [];
    let isLockedSectionUnlocked = false;
    let images = [];
    let hasSetPassword = false;
    let lockedPassword = '';

    // DOM Elements
    const tabs = document.querySelectorAll('.tab');
    const tabContents = document.querySelectorAll('.tab-content');
    
    // Regular Notes Elements
    const notebooksView = document.getElementById('notebooks-view');
    const notebookNotesView = document.getElementById('notebook-notes-view');
    const notebookTitleInput = document.getElementById('notebook-title');
    const createNotebookBtn = document.getElementById('create-notebook');
    const notebooksList = document.getElementById('notebooks-list');
    const backToNotebooksBtn = document.getElementById('back-to-notebooks');
    const currentNotebookTitle = document.getElementById('current-notebook-title');
    const noteContentInput = document.getElementById('note-content');
    const addNoteBtn = document.getElementById('add-note');
    const notesList = document.getElementById('notes-list');

    // Checklist Elements
    const checklistGroupsView = document.getElementById('checklist-groups-view');
    const checklistGroupItemsView = document.getElementById('checklist-group-items-view');
    const checklistGroupTitleInput = document.getElementById('checklist-group-title');
    const createChecklistGroupBtn = document.getElementById('create-checklist-group');
    const checklistGroupsList = document.getElementById('checklist-groups-list');
    const backToChecklistGroupsBtn = document.getElementById('back-to-checklist-groups');
    const currentChecklistGroupTitle = document.getElementById('current-checklist-group-title');
    const checklistItemsInput = document.getElementById('checklist-items');
    const addChecklistBtn = document.getElementById('add-checklist');
    const checklistsList = document.getElementById('checklists-list');

    // Locked Notes Elements
    const lockedAuth = document.getElementById('locked-auth');
    const lockedNotesView = document.getElementById('locked-notes-view');
    const lockedPasswordInput = document.getElementById('locked-password');
    const togglePasswordBtn = document.getElementById('toggle-password');
    const unlockNotesBtn = document.getElementById('unlock-notes');
    const lockedNoteContentInput = document.getElementById('locked-note-content');
    const addLockedNoteBtn = document.getElementById('add-locked-note');
    const lockedNotesList = document.getElementById('locked-notes-list');
    const setPasswordModal = document.getElementById('set-password-modal');
    const newPasswordInput = document.getElementById('new-password');
    const confirmPasswordInput = document.getElementById('confirm-password');
    const savePasswordBtn = document.getElementById('save-password');
    const modalCloseBtn = document.querySelector('#set-password-modal .modal-close');

    // Images Elements
    const imageInput = document.getElementById('image-input');
    const uploadBtn = document.getElementById('upload-btn');
    const imagesList = document.getElementById('images-list');
    const editImageModal = document.getElementById('edit-image-modal');
    const imageNameInput = document.getElementById('image-name-input');
    const editImageId = document.getElementById('edit-image-id');
    const saveImageNameBtn = document.getElementById('save-image-name');
    const editImageModalCloseBtn = document.querySelector('#edit-image-modal .modal-close');

    // Fullscreen Image Viewer Elements
    const fullscreenViewer = document.getElementById('fullscreen-image-viewer');
    const fullscreenImg = document.getElementById('fullscreen-img');
    const fullscreenInfo = document.getElementById('fullscreen-image-info');
    const fullscreenCloseBtn = document.getElementById('fullscreen-close');

    // Backup/Import Elements
    const backupBtn = document.getElementById('backup-data');
    const importBtn = document.getElementById('import-data');
    const importInput = document.getElementById('import-input');

    // Initialize the app
    function init() {
      // Load data from localStorage
      loadNotebooks();
      loadChecklistGroups();
      loadLockedNotes();
      loadImages();
      checkPasswordStatus();
      
      // Set up event listeners
      setupEventListeners();
    }

    // Set up event listeners
    function setupEventListeners() {
      // Tab navigation
      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          const tabName = tab.getAttribute('data-tab');
          switchTab(tabName);
        });
      });

      // Regular Notes
      createNotebookBtn.addEventListener('click', createNotebook);
      backToNotebooksBtn.addEventListener('click', backToNotebooks);
      addNoteBtn.addEventListener('click', addNote);

      // Checklists
      createChecklistGroupBtn.addEventListener('click', createChecklistGroup);
      backToChecklistGroupsBtn.addEventListener('click', backToChecklistGroups);
      addChecklistBtn.addEventListener('click', addChecklist);

      // Locked Notes
      togglePasswordBtn.addEventListener('click', togglePasswordVisibility);
      unlockNotesBtn.addEventListener('click', unlockNotes);
      addLockedNoteBtn.addEventListener('click', addLockedNote);
      savePasswordBtn.addEventListener('click', savePassword);
      modalCloseBtn.addEventListener('click', () => setPasswordModal.style.display = 'none');

      // Images
      uploadBtn.addEventListener('click', () => imageInput.click());
      imageInput.addEventListener('change', handleImageUpload);
      saveImageNameBtn.addEventListener('click', saveImageName);
      editImageModalCloseBtn.addEventListener('click', () => editImageModal.style.display = 'none');
      
      // Fullscreen Image Viewer
      fullscreenCloseBtn.addEventListener('click', closeFullscreenImage);
      
      // Backup/Import
      backupBtn.addEventListener('click', backupData);
      importBtn.addEventListener('click', () => importInput.click());
      importInput.addEventListener('change', importData);
    }

    // Switch between tabs
    function switchTab(tabName) {
      currentTab = tabName;
      
      // Update active tab
      tabs.forEach(tab => {
        if (tab.getAttribute('data-tab') === tabName) {
          tab.classList.add('active');
        } else {
          tab.classList.remove('active');
        }
      });
      
      // Show active tab content
      tabContents.forEach(content => {
        if (content.id === tabName) {
          content.classList.add('active');
        } else {
          content.classList.remove('active');
        }
      });

      // Check if we need to show the set password modal
      if (tabName === 'locked' && !hasSetPassword) {
        setPasswordModal.style.display = 'flex';
      }
    }

    // ===== REGULAR NOTES FUNCTIONS =====
    
    // Load notebooks from localStorage
    function loadNotebooks() {
      const savedNotebooks = localStorage.getItem('notebooks');
      if (savedNotebooks) {
        notebooks = JSON.parse(savedNotebooks);
      } else {
        // Add sample notebooks if none exist
        notebooks = [
          {
            id: 1,
            title: 'Work Notes',
            notes: [
              {
                id: 1,
                content: 'Meeting with team at 2pm',
                timestamp: '15/01/2023, 15:30:00'
              },
              {
                id: 2,
                content: 'Project deadline on Friday',
                timestamp: '16/01/2023, 20:00:00'
              }
            ]
          },
          {
            id: 2,
            title: 'Personal',
            notes: [
              {
                id: 3,
                content: 'Buy groceries',
                timestamp: '17/01/2023, 10:15:00'
              }
            ]
          }
        ];
        saveNotebooks();
      }
      renderNotebooks();
    }

    // Save notebooks to localStorage
    function saveNotebooks() {
      localStorage.setItem('notebooks', JSON.stringify(notebooks));
    }

    // Render notebooks list
    function renderNotebooks() {
      notebooksList.innerHTML = '';
      
      if (notebooks.length === 0) {
        notebooksList.innerHTML = '<p style="color: var(--text-secondary);">No notebooks found. Create one to get started!</p>';
        return;
      }
      
      notebooks.forEach(notebook => {
        const notebookEl = document.createElement('div');
        notebookEl.className = 'card notebook';
        notebookEl.innerHTML = `
          <div class="card-header">
            <h3 class="notebook-title">${notebook.title}</h3>
            <button class="btn btn-ghost btn-icon absolute top-2 right-2 delete-notebook" data-id="${notebook.id}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="card-footer">
            <span class="notebook-count">${notebook.notes.length} notes</span>
          </div>
        `;
        
        // Open notebook on click
        notebookEl.addEventListener('click', (e) => {
          // Don't open if delete button was clicked
          if (!e.target.closest('.delete-notebook')) {
            openNotebook(notebook.id);
          }
        });
        
        // Delete notebook
        const deleteBtn = notebookEl.querySelector('.delete-notebook');
        deleteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          deleteNotebook(notebook.id);
        });
        
        notebooksList.appendChild(notebookEl);
      });
    }

    // Create a new notebook
    function createNotebook() {
      const title = notebookTitleInput.value.trim();
      if (!title) {
        alert('Please enter a notebook title');
        return;
      }
      
      const newNotebook = {
        id: Date.now(),
        title: title,
        notes: []
      };
      
      notebooks.push(newNotebook);
      saveNotebooks();
      renderNotebooks();
      
      notebookTitleInput.value = '';
    }

    // Open a notebook
    function openNotebook(notebookId) {
      currentNotebookId = notebookId;
      const notebook = notebooks.find(nb => nb.id === notebookId);
      
      if (notebook) {
        currentNotebookTitle.textContent = notebook.title;
        renderNotes(notebook.notes);
        
        notebooksView.classList.add('hidden');
        notebookNotesView.classList.remove('hidden');
      }
    }

    // Go back to notebooks list
    function backToNotebooks() {
      currentNotebookId = null;
      notebooksView.classList.remove('hidden');
      notebookNotesView.classList.add('hidden');
    }

    // Render notes for a notebook
    function renderNotes(notes) {
      notesList.innerHTML = '';
      
      if (notes.length === 0) {
        notesList.innerHTML = '<p style="color: var(--text-secondary);">No notes in this notebook. Add one to get started!</p>';
        return;
      }
      
      notes.forEach(note => {
        const noteEl = document.createElement('div');
        noteEl.className = 'card note';
        noteEl.innerHTML = `
          <div class="note-actions">
            <button class="btn btn-ghost btn-icon edit-note" data-id="${note.id}">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-ghost btn-icon delete-note" data-id="${note.id}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="card-content">
            <p class="note-content">${note.content}</p>
          </div>
          <div class="card-footer">
            <span class="note-timestamp">${note.timestamp}</span>
          </div>
        `;
        
        // Delete note
        const deleteBtn = noteEl.querySelector('.delete-note');
        deleteBtn.addEventListener('click', () => {
          deleteNote(note.id);
        });
        
        // Edit note (to be implemented)
        const editBtn = noteEl.querySelector('.edit-note');
        editBtn.addEventListener('click', () => {
          // This would be implemented in a full version
          alert('Edit functionality would be here in a complete implementation');
        });
        
        notesList.appendChild(noteEl);
      });
    }

    // Add a new note to the current notebook
    function addNote() {
      const content = noteContentInput.value.trim();
      if (!content) {
        alert('Please enter note content');
        return;
      }
      
      const notebook = notebooks.find(nb => nb.id === currentNotebookId);
      if (notebook) {
        const newNote = {
          id: Date.now(),
          content: content,
          timestamp: new Date().toLocaleString()
        };
        
        notebook.notes.push(newNote);
        saveNotebooks();
        renderNotes(notebook.notes);
        
        noteContentInput.value = '';
      }
    }

    // Delete a note
    function deleteNote(noteId) {
      if (confirm('Are you sure you want to delete this note?')) {
        const notebook = notebooks.find(nb => nb.id === currentNotebookId);
        if (notebook) {
          notebook.notes = notebook.notes.filter(note => note.id !== noteId);
          saveNotebooks();
          renderNotes(notebook.notes);
        }
      }
    }

    // Delete a notebook
    function deleteNotebook(notebookId) {
      if (confirm('Are you sure you want to delete this notebook and all its notes?')) {
        notebooks = notebooks.filter(notebook => notebook.id !== notebookId);
        saveNotebooks();
        renderNotebooks();
      }
    }

    // ===== CHECKLIST FUNCTIONS =====
    
    // Load checklist groups from localStorage
    function loadChecklistGroups() {
      const savedGroups = localStorage.getItem('checklistGroups');
      if (savedGroups) {
        checklistGroups = JSON.parse(savedGroups);
      } else {
        // Add sample checklist group if none exist
        checklistGroups = [
          {
            id: 1,
            title: 'Shopping List',
            checklists: [
              {
                id: 1,
                items: ['Milk', 'Eggs', 'Bread', 'Fruits'],
                checked: [false, true, false, false],
                timestamp: '15/01/2023, 15:30:00'
              }
            ]
          }
        ];
        saveChecklistGroups();
      }
      renderChecklistGroups();
    }

    // Save checklist groups to localStorage
    function saveChecklistGroups() {
      localStorage.setItem('checklistGroups', JSON.stringify(checklistGroups));
    }

    // Render checklist groups
    function renderChecklistGroups() {
      checklistGroupsList.innerHTML = '';
      
      if (checklistGroups.length === 0) {
        checklistGroupsList.innerHTML = '<p style="color: var(--text-secondary);">No checklist groups found. Create one to get started!</p>';
        return;
      }
      
      checklistGroups.forEach(group => {
        const groupEl = document.createElement('div');
        groupEl.className = 'card notebook';
        groupEl.innerHTML = `
          <div class="card-header">
            <h3 class="notebook-title">${group.title}</h3>
            <button class="btn btn-ghost btn-icon absolute top-2 right-2 delete-checklist-group" data-id="${group.id}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="card-footer">
            <span class="notebook-count">${group.checklists.length} checklists</span>
          </div>
        `;
        
        // Open checklist group on click
        groupEl.addEventListener('click', (e) => {
          // Don't open if delete button was clicked
          if (!e.target.closest('.delete-checklist-group')) {
            openChecklistGroup(group.id);
          }
        });
        
        // Delete checklist group
        const deleteBtn = groupEl.querySelector('.delete-checklist-group');
        deleteBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          deleteChecklistGroup(group.id);
        });
        
        checklistGroupsList.appendChild(groupEl);
      });
    }

    // Create a new checklist group
    function createChecklistGroup() {
      const title = checklistGroupTitleInput.value.trim();
      if (!title) {
        alert('Please enter a checklist group title');
        return;
      }
      
      const newGroup = {
        id: Date.now(),
        title: title,
        checklists: []
      };
      
      checklistGroups.push(newGroup);
      saveChecklistGroups();
      renderChecklistGroups();
      
      checklistGroupTitleInput.value = '';
    }

    // Open a checklist group
    function openChecklistGroup(groupId) {
      currentChecklistGroupId = groupId;
      const group = checklistGroups.find(g => g.id === groupId);
      
      if (group) {
        currentChecklistGroupTitle.textContent = group.title;
        renderChecklists(group.checklists);
        
        checklistGroupsView.classList.add('hidden');
        checklistGroupItemsView.classList.remove('hidden');
      }
    }

    // Go back to checklist groups list
    function backToChecklistGroups() {
      currentChecklistGroupId = null;
      checklistGroupsView.classList.remove('hidden');
      checklistGroupItemsView.classList.add('hidden');
    }

    // Render checklists for a group
    function renderChecklists(checklists) {
      checklistsList.innerHTML = '';
      
      if (checklists.length === 0) {
        checklistsList.innerHTML = '<p style="color: var(--text-secondary);">No checklists in this group. Add one to get started!</p>';
        return;
      }
      
      checklists.forEach(checklist => {
        const checklistEl = document.createElement('div');
        checklistEl.className = 'card note';
        
        let itemsHTML = '';
        checklist.items.forEach((item, index) => {
          itemsHTML += `
            <label class="checklist-item">
              <input type="checkbox" ${checklist.checked[index] ? 'checked' : ''} data-checklist-id="${checklist.id}" data-item-index="${index}">
              <span>${item}</span>
            </label>
          `;
        });
        
        checklistEl.innerHTML = `
          <div class="note-actions">
            <button class="btn btn-ghost btn-icon delete-checklist" data-id="${checklist.id}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="card-content">
            ${itemsHTML}
          </div>
          <div class="card-footer">
            <span class="note-timestamp">${checklist.timestamp}</span>
          </div>
        `;
        
        // Delete checklist
        const deleteBtn = checklistEl.querySelector('.delete-checklist');
        deleteBtn.addEventListener('click', () => {
          deleteChecklist(checklist.id);
        });
        
        // Toggle checklist items
        const checkboxes = checklistEl.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => {
          checkbox.addEventListener('change', () => {
            const checklistId = parseInt(checkbox.getAttribute('data-checklist-id'));
            const itemIndex = parseInt(checkbox.getAttribute('data-item-index'));
            toggleChecklistItem(checklistId, itemIndex, checkbox.checked);
          });
        });
        
        checklistsList.appendChild(checklistEl);
      });
    }

    // Add a new checklist to the current group
    function addChecklist() {
      const content = checklistItemsInput.value.trim();
      if (!content) {
        alert('Please enter checklist items');
        return;
      }
      
      const group = checklistGroups.find(g => g.id === currentChecklistGroupId);
      if (group) {
        const items = content.split('\n').filter(item => item.trim() !== '');
        
        const newChecklist = {
          id: Date.now(),
          items: items,
          checked: Array(items.length).fill(false),
          timestamp: new Date().toLocaleString()
        };
        
        group.checklists.push(newChecklist);
        saveChecklistGroups();
        renderChecklists(group.checklists);
        
        checklistItemsInput.value = '';
      }
    }

    // Toggle a checklist item
    function toggleChecklistItem(checklistId, itemIndex, isChecked) {
      const group = checklistGroups.find(g => g.id === currentChecklistGroupId);
      if (group) {
        const checklist = group.checklists.find(c => c.id === checklistId);
        if (checklist) {
          checklist.checked[itemIndex] = isChecked;
          saveChecklistGroups();
        }
      }
    }

    // Delete a checklist
    function deleteChecklist(checklistId) {
      if (confirm('Are you sure you want to delete this checklist?')) {
        const group = checklistGroups.find(g => g.id === currentChecklistGroupId);
        if (group) {
          group.checklists = group.checklists.filter(checklist => checklist.id !== checklistId);
          saveChecklistGroups();
          renderChecklists(group.checklists);
        }
      }
    }

    // Delete a checklist group
    function deleteChecklistGroup(groupId) {
      if (confirm('Are you sure you want to delete this checklist group and all its checklists?')) {
        checklistGroups = checklistGroups.filter(group => group.id !== groupId);
        saveChecklistGroups();
        renderChecklistGroups();
      }
    }

    // ===== LOCKED NOTES FUNCTIONS =====
    
    // Check if password has been set
    function checkPasswordStatus() {
      const savedPassword = localStorage.getItem('lockedPassword');
      if (savedPassword) {
        hasSetPassword = true;
        lockedPassword = savedPassword;
      }
    }
    
    // Load locked notes from localStorage
    function loadLockedNotes() {
      const savedNotes = localStorage.getItem('lockedNotes');
      if (savedNotes) {
        lockedNotes = JSON.parse(savedNotes);
      }
    }

    // Save locked notes to localStorage
    function saveLockedNotes() {
      localStorage.setItem('lockedNotes', JSON.stringify(lockedNotes));
    }

    // Toggle password visibility
    function togglePasswordVisibility() {
      const passwordInput = document.getElementById('locked-password');
      const icon = togglePasswordBtn.querySelector('i');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.className = 'fas fa-eye-slash';
      } else {
        passwordInput.type = 'password';
        icon.className = 'fas fa-eye';
      }
    }

    // Save password
    function savePassword() {
      const newPassword = newPasswordInput.value.trim();
      const confirmPassword = confirmPasswordInput.value.trim();
      
      if (!newPassword) {
        alert('Please enter a password');
        return;
      }
      
      if (newPassword !== confirmPassword) {
        alert('Passwords do not match');
        return;
      }
      
      // Save password to localStorage
      localStorage.setItem('lockedPassword', newPassword);
      lockedPassword = newPassword;
      hasSetPassword = true;
      
      // Close modal
      setPasswordModal.style.display = 'none';
      
      // Clear inputs
      newPasswordInput.value = '';
      confirmPasswordInput.value = '';
    }

    // Unlock the locked notes section
    function unlockNotes() {
      const password = lockedPasswordInput.value.trim();
      if (!password) {
        alert('Please enter a password');
        return;
      }
      
      // Check if password matches
      if (password === lockedPassword) {
        isLockedSectionUnlocked = true;
        
        lockedAuth.classList.add('hidden');
        lockedNotesView.classList.remove('hidden');
        
        renderLockedNotes();
      } else {
        alert('Incorrect password');
      }
    }

    // Render locked notes
    function renderLockedNotes() {
      lockedNotesList.innerHTML = '';
      
      if (lockedNotes.length === 0) {
        lockedNotesList.innerHTML = '<p style="color: var(--text-secondary);">No locked notes found. Add one to get started!</p>';
        return;
      }
      
      lockedNotes.forEach(note => {
        const noteEl = document.createElement('div');
        noteEl.className = 'card note';
        noteEl.innerHTML = `
          <div class="note-actions">
            <button class="btn btn-ghost btn-icon delete-locked-note" data-id="${note.id}">
              <i class="fas fa-trash"></i>
            </button>
          </div>
          <div class="card-content">
            <p class="note-content">${note.content}</p>
          </div>
          <div class="card-footer">
            <span class="note-timestamp">${note.timestamp}</span>
          </div>
        `;
        
        // Delete locked note
        const deleteBtn = noteEl.querySelector('.delete-locked-note');
        deleteBtn.addEventListener('click', () => {
          deleteLockedNote(note.id);
        });
        
        lockedNotesList.appendChild(noteEl);
      });
    }

    // Add a new locked note
    function addLockedNote() {
      const content = lockedNoteContentInput.value.trim();
      if (!content) {
        alert('Please enter note content');
        return;
      }
      
      const newNote = {
        id: Date.now(),
        content: content,
        timestamp: new Date().toLocaleString()
      };
      
      lockedNotes.push(newNote);
      saveLockedNotes();
      renderLockedNotes();
      
      lockedNoteContentInput.value = '';
    }

    // Delete a locked note
    function deleteLockedNote(noteId) {
      if (confirm('Are you sure you want to delete this locked note?')) {
        lockedNotes = lockedNotes.filter(note => note.id !== noteId);
        saveLockedNotes();
        renderLockedNotes();
      }
    }

    // ===== IMAGES FUNCTIONS =====
    
    // Load images from localStorage
    function loadImages() {
      const savedImages = localStorage.getItem('images');
      if (savedImages) {
        images = JSON.parse(savedImages);
        renderImages();
      }
    }

    // Save images to localStorage
    function saveImages() {
      localStorage.setItem('images', JSON.stringify(images));
    }

    // Handle image upload
    function handleImageUpload(e) {
      const files = e.target.files;
      if (!files || files.length === 0) return;
      
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const reader = new FileReader();
        
        reader.onload = function(event) {
          const newImage = {
            id: Date.now() + i,
            name: file.name,
            src: event.target.result,
            timestamp: new Date().toLocaleString()
          };
          
          images.push(newImage);
          saveImages();
          renderImages();
        };
        
        reader.readAsDataURL(file);
      }
      
      // Clear the input
      e.target.value = '';
    }

    // Render images
    function renderImages() {
      imagesList.innerHTML = '';
      
      if (images.length === 0) {
        imagesList.innerHTML = '<p style="color: var(--text-secondary);">No images found. Upload some to get started!</p>';
        return;
      }
      
      images.forEach(image => {
        // Truncate image name
        const truncatedName = image.name.length > 4 ? 
          image.name.substring(0, 4) + '...' : 
          image.name;
          
        const imageEl = document.createElement('div');
        imageEl.className = 'card image-card';
        imageEl.innerHTML = `
          <img src="${image.src}" alt="${image.name}" class="view-image" data-id="${image.id}">
          <div class="card-footer">
            <span class="truncated-name" title="${image.name}">${truncatedName}</span>
            <div class="flex">
              <button class="btn btn-ghost btn-icon mr-2 edit-image" data-id="${image.id}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-ghost btn-icon delete-image" data-id="${image.id}">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        `;
        
        // View image in fullscreen
        const imgElement = imageEl.querySelector('.view-image');
        imgElement.addEventListener('click', () => {
          openFullscreenImage(image.id);
        });
        
        // Edit image name
        const editBtn = imageEl.querySelector('.edit-image');
        editBtn.addEventListener('click', () => {
          openEditImageModal(image.id);
        });
        
        // Delete image
        const deleteBtn = imageEl.querySelector('.delete-image');
        deleteBtn.addEventListener('click', () => {
          deleteImage(image.id);
        });
        
        imagesList.appendChild(imageEl);
      });
    }

    // Open fullscreen image viewer
    function openFullscreenImage(imageId) {
      const image = images.find(img => img.id === imageId);
      if (image) {
        fullscreenImg.src = image.src;
        fullscreenInfo.textContent = image.name;
        fullscreenViewer.style.display = 'flex';
      }
    }

    // Close fullscreen image viewer
    function closeFullscreenImage() {
      fullscreenViewer.style.display = 'none';
    }

    // Open edit image modal
    function openEditImageModal(imageId) {
      const image = images.find(img => img.id === imageId);
      if (image) {
        imageNameInput.value = image.name;
        editImageId.value = imageId;
        editImageModal.style.display = 'flex';
      }
    }

    // Save image name
    function saveImageName() {
      const imageId = parseInt(editImageId.value);
      const newName = imageNameInput.value.trim();
      
      if (!newName) {
        alert('Please enter an image name');
        return;
      }
      
      const image = images.find(img => img.id === imageId);
      if (image) {
        image.name = newName;
        saveImages();
        renderImages();
        
        // Close modal
        editImageModal.style.display = 'none';
      }
    }

    // Delete an image
    function deleteImage(imageId) {
      if (confirm('Are you sure you want to delete this image?')) {
        images = images.filter(image => image.id !== imageId);
        saveImages();
        renderImages();
      }
    }

    // ===== BACKUP/IMPORT FUNCTIONS =====
    
    // Backup all data to a JSON file
    function backupData() {
      const data = {
        notebooks: notebooks,
        checklistGroups: checklistGroups,
        lockedNotes: lockedNotes,
        images: images,
        hasSetPassword: hasSetPassword,
        lockedPassword: lockedPassword
      };
      
      const dataStr = JSON.stringify(data);
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      
      const exportFileDefaultName = 'enotes-backup-' + new Date().toISOString().slice(0, 10) + '.json';
      
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', exportFileDefaultName);
      linkElement.click();
    }
    
    // Import data from a JSON file
    function importData(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      
      reader.onload = function(event) {
        try {
          const data = JSON.parse(event.target.result);
          
          // Validate data structure
          if (data.notebooks && data.checklistGroups && data.images) {
            // Import data
            notebooks = data.notebooks;
            checklistGroups = data.checklistGroups;
            lockedNotes = data.lockedNotes || [];
            images = data.images;
            
            if (data.hasSetPassword && data.lockedPassword) {
              hasSetPassword = data.hasSetPassword;
              lockedPassword = data.lockedPassword;
              localStorage.setItem('lockedPassword', lockedPassword);
            }
            
            // Save to localStorage
            saveNotebooks();
            saveChecklistGroups();
            saveLockedNotes();
            saveImages();
            
            // Refresh UI
            renderNotebooks();
            renderChecklistGroups();
            renderImages();
            
            alert('Data imported successfully!');
          } else {
            alert('Invalid backup file format');
          }
        } catch (error) {
          alert('Error importing data: ' + error.message);
        }
      };
      
      reader.readAsText(file);
      
      // Clear the input
      e.target.value = '';
    }

    // Initialize the app when the DOM is loaded
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>